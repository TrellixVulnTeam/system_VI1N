<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.10">
<meta name="author" content="&lt;wangpeng20199@gmail.com&gt;">
<title>系统工程师实战</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
/* ========================================================================== HTML5 display definitions ========================================================================== */
/** Correct `block` display not defined in IE 8/9. */
article, aside, details, figcaption, figure, footer, header, hgroup, main, nav, section, summary { display: block; }

/** Correct `inline-block` display not defined in IE 8/9. */
audio, canvas, video { display: inline-block; }

/** Prevent modern browsers from displaying `audio` without controls. Remove excess height in iOS 5 devices. */
audio:not([controls]) { display: none; height: 0; }

/** Address `[hidden]` styling not present in IE 8/9. Hide the `template` element in IE, Safari, and Firefox < 22. */
[hidden], template { display: none; }

script { display: none !important; }

/* ========================================================================== Base ========================================================================== */
/** 1. Set default font family to sans-serif. 2. Prevent iOS text size adjust after orientation change, without disabling user zoom. */
html { font-family: sans-serif; /* 1 */ -ms-text-size-adjust: 100%; /* 2 */ -webkit-text-size-adjust: 100%; /* 2 */ }

/** Remove default margin. */
body { margin: 0; }

/* ========================================================================== Links ========================================================================== */
/** Remove the gray background color from active links in IE 10. */
a { background: transparent; }

/** Address `outline` inconsistency between Chrome and other browsers. */
a:focus { outline: thin dotted; }

/** Improve readability when focused and also mouse hovered in all browsers. */
a:active, a:hover { outline: 0; }

/* ========================================================================== Typography ========================================================================== */
/** Address variable `h1` font-size and margin within `section` and `article` contexts in Firefox 4+, Safari 5, and Chrome. */
h1 { font-size: 2em; margin: 0.67em 0; }

/** Address styling not present in IE 8/9, Safari 5, and Chrome. */
abbr[title] { border-bottom: 1px dotted; }

/** Address style set to `bolder` in Firefox 4+, Safari 5, and Chrome. */
b, strong { font-weight: bold; }

/** Address styling not present in Safari 5 and Chrome. */
dfn { font-style: italic; }

/** Address differences between Firefox and other browsers. */
hr { -moz-box-sizing: content-box; box-sizing: content-box; height: 0; }

/** Address styling not present in IE 8/9. */
mark { background: #ff0; color: #000; }

/** Correct font family set oddly in Safari 5 and Chrome. */
code, kbd, pre, samp { font-family: monospace, serif; font-size: 1em; }

/** Improve readability of pre-formatted text in all browsers. */
pre { white-space: pre-wrap; }

/** Set consistent quote types. */
q { quotes: "\201C" "\201D" "\2018" "\2019"; }

/** Address inconsistent and variable font size in all browsers. */
small { font-size: 80%; }

/** Prevent `sub` and `sup` affecting `line-height` in all browsers. */
sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; }

sup { top: -0.5em; }

sub { bottom: -0.25em; }

/* ========================================================================== Embedded content ========================================================================== */
/** Remove border when inside `a` element in IE 8/9. */
img { border: 0; }

/** Correct overflow displayed oddly in IE 9. */
svg:not(:root) { overflow: hidden; }

/* ========================================================================== Figures ========================================================================== */
/** Address margin not present in IE 8/9 and Safari 5. */
figure { margin: 0; }

/* ========================================================================== Forms ========================================================================== */
/** Define consistent border, margin, and padding. */
fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; }

/** 1. Correct `color` not being inherited in IE 8/9. 2. Remove padding so people aren't caught out if they zero out fieldsets. */
legend { border: 0; /* 1 */ padding: 0; /* 2 */ }

/** 1. Correct font family not being inherited in all browsers. 2. Correct font size not being inherited in all browsers. 3. Address margins set differently in Firefox 4+, Safari 5, and Chrome. */
button, input, select, textarea { font-family: inherit; /* 1 */ font-size: 100%; /* 2 */ margin: 0; /* 3 */ }

/** Address Firefox 4+ setting `line-height` on `input` using `!important` in the UA stylesheet. */
button, input { line-height: normal; }

/** Address inconsistent `text-transform` inheritance for `button` and `select`. All other form control elements do not inherit `text-transform` values. Correct `button` style inheritance in Chrome, Safari 5+, and IE 8+. Correct `select` style inheritance in Firefox 4+ and Opera. */
button, select { text-transform: none; }

/** 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio` and `video` controls. 2. Correct inability to style clickable `input` types in iOS. 3. Improve usability and consistency of cursor style between image-type `input` and others. */
button, html input[type="button"], input[type="reset"], input[type="submit"] { -webkit-appearance: button; /* 2 */ cursor: pointer; /* 3 */ }

/** Re-set default cursor for disabled elements. */
button[disabled], html input[disabled] { cursor: default; }

/** 1. Address box sizing set to `content-box` in IE 8/9. 2. Remove excess padding in IE 8/9. */
input[type="checkbox"], input[type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ }

/** 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome. 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome (include `-moz` to future-proof). */
input[type="search"] { -webkit-appearance: textfield; /* 1 */ -moz-box-sizing: content-box; -webkit-box-sizing: content-box; /* 2 */ box-sizing: content-box; }

/** Remove inner padding and search cancel button in Safari 5 and Chrome on OS X. */
input[type="search"]::-webkit-search-cancel-button, input[type="search"]::-webkit-search-decoration { -webkit-appearance: none; }

/** Remove inner padding and border in Firefox 4+. */
button::-moz-focus-inner, input::-moz-focus-inner { border: 0; padding: 0; }

/** 1. Remove default vertical scrollbar in IE 8/9. 2. Improve readability and alignment in all browsers. */
textarea { overflow: auto; /* 1 */ vertical-align: top; /* 2 */ }

/* ========================================================================== Tables ========================================================================== */
/** Remove most spacing between table cells. */
table { border-collapse: collapse; border-spacing: 0; }

meta.foundation-mq-small { font-family: "only screen and (min-width: 768px)"; width: 768px; }

meta.foundation-mq-medium { font-family: "only screen and (min-width:1280px)"; width: 1280px; }

meta.foundation-mq-large { font-family: "only screen and (min-width:1440px)"; width: 1440px; }

*, *:before, *:after { -moz-box-sizing: border-box; -webkit-box-sizing: border-box; box-sizing: border-box; }

html, body { font-size: 100%; }

body { background: white; color: rgba(0, 0, 0, 0.8); padding: 0; margin: 0; font-family: "Noto Serif", "DejaVu Serif", serif; font-weight: normal; font-style: normal; line-height: 1; position: relative; cursor: auto; }

a:hover { cursor: pointer; }

img, object, embed { max-width: 100%; height: auto; }

object, embed { height: 100%; }

img { -ms-interpolation-mode: bicubic; }

#map_canvas img, #map_canvas embed, #map_canvas object, .map_canvas img, .map_canvas embed, .map_canvas object { max-width: none !important; }

.left { float: left !important; }

.right { float: right !important; }

.text-left { text-align: left !important; }

.text-right { text-align: right !important; }

.text-center { text-align: center !important; }

.text-justify { text-align: justify !important; }

.hide { display: none; }

.antialiased, body { -webkit-font-smoothing: antialiased; }

img { display: inline-block; vertical-align: middle; }

textarea { height: auto; min-height: 50px; }

select { width: 100%; }

object, svg { display: inline-block; vertical-align: middle; }

.center { margin-left: auto; margin-right: auto; }

.spread { width: 100%; }

p.lead, .paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { font-size: 1.21875em; line-height: 1.6; }

.subheader, .admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { line-height: 1.45; color: #7a2518; font-weight: normal; margin-top: 0; margin-bottom: 0.25em; }

/* Typography resets */
div, dl, dt, dd, ul, ol, li, h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6, pre, form, p, blockquote, th, td { margin: 0; padding: 0; direction: ltr; }

/* Default Link Styles */
a { color: #2156a5; text-decoration: underline; line-height: inherit; }
a:hover, a:focus { color: #1d4b8f; }
a img { border: none; }

/* Default paragraph styles */
p { font-family: inherit; font-weight: normal; font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; text-rendering: optimizeLegibility; }
p aside { font-size: 0.875em; line-height: 1.35; font-style: italic; }

/* Default header styles */
h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { font-family: "Open Sans", "DejaVu Sans", sans-serif; font-weight: 300; font-style: normal; color: #ba3925; text-rendering: optimizeLegibility; margin-top: 1em; margin-bottom: 0.5em; line-height: 1.0125em; }
h1 small, h2 small, h3 small, #toctitle small, .sidebarblock > .content > .title small, h4 small, h5 small, h6 small { font-size: 60%; color: #e99b8f; line-height: 0; }

h1 { font-size: 2.125em; }

h2 { font-size: 1.6875em; }

h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.375em; }

h4 { font-size: 1.125em; }

h5 { font-size: 1.125em; }

h6 { font-size: 1em; }

hr { border: solid #ddddd8; border-width: 1px 0 0; clear: both; margin: 1.25em 0 1.1875em; height: 0; }

/* Helpful Typography Defaults */
em, i { font-style: italic; line-height: inherit; }

strong, b { font-weight: bold; line-height: inherit; }

small { font-size: 60%; line-height: inherit; }

code { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; font-weight: normal; color: rgba(0, 0, 0, 0.9); }

/* Lists */
ul, ol, dl { font-size: 1em; line-height: 1.6; margin-bottom: 1.25em; list-style-position: outside; font-family: inherit; }

ul, ol { margin-left: 1.5em; }
ul.no-bullet, ol.no-bullet { margin-left: 1.5em; }

/* Unordered Lists */
ul li ul, ul li ol { margin-left: 1.25em; margin-bottom: 0; font-size: 1em; /* Override nested font-size change */ }
ul.square li ul, ul.circle li ul, ul.disc li ul { list-style: inherit; }
ul.square { list-style-type: square; }
ul.circle { list-style-type: circle; }
ul.disc { list-style-type: disc; }
ul.no-bullet { list-style: none; }

/* Ordered Lists */
ol li ul, ol li ol { margin-left: 1.25em; margin-bottom: 0; }

/* Definition Lists */
dl dt { margin-bottom: 0.3125em; font-weight: bold; }
dl dd { margin-bottom: 1.25em; }

/* Abbreviations */
abbr, acronym { text-transform: uppercase; font-size: 90%; color: rgba(0, 0, 0, 0.8); border-bottom: 1px dotted #dddddd; cursor: help; }

abbr { text-transform: none; }

/* Blockquotes */
blockquote { margin: 0 0 1.25em; padding: 0.5625em 1.25em 0 1.1875em; border-left: 1px solid #dddddd; }
blockquote cite { display: block; font-size: 0.9375em; color: rgba(0, 0, 0, 0.6); }
blockquote cite:before { content: "\2014 \0020"; }
blockquote cite a, blockquote cite a:visited { color: rgba(0, 0, 0, 0.6); }

blockquote, blockquote p { line-height: 1.6; color: rgba(0, 0, 0, 0.85); }

/* Microformats */
.vcard { display: inline-block; margin: 0 0 1.25em 0; border: 1px solid #dddddd; padding: 0.625em 0.75em; }
.vcard li { margin: 0; display: block; }
.vcard .fn { font-weight: bold; font-size: 0.9375em; }

.vevent .summary { font-weight: bold; }
.vevent abbr { cursor: auto; text-decoration: none; font-weight: bold; border: none; padding: 0 0.0625em; }

@media only screen and (min-width: 768px) { h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; }
  h1 { font-size: 2.75em; }
  h2 { font-size: 2.3125em; }
  h3, #toctitle, .sidebarblock > .content > .title { font-size: 1.6875em; }
  h4 { font-size: 1.4375em; } }
/* Tables */
table { background: white; margin-bottom: 1.25em; border: solid 1px #dedede; }
table thead, table tfoot { background: #f7f8f7; font-weight: bold; }
table thead tr th, table thead tr td, table tfoot tr th, table tfoot tr td { padding: 0.5em 0.625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); text-align: left; }
table tr th, table tr td { padding: 0.5625em 0.625em; font-size: inherit; color: rgba(0, 0, 0, 0.8); }
table tr.even, table tr.alt, table tr:nth-of-type(even) { background: #f8f8f7; }
table thead tr th, table tfoot tr th, table tbody tr td, table tr td, table tfoot tr td { display: table-cell; line-height: 1.6; }

body { tab-size: 4; }

h1, h2, h3, #toctitle, .sidebarblock > .content > .title, h4, h5, h6 { line-height: 1.2; word-spacing: -0.05em; }
h1 strong, h2 strong, h3 strong, #toctitle strong, .sidebarblock > .content > .title strong, h4 strong, h5 strong, h6 strong { font-weight: 400; }

.clearfix:before, .clearfix:after, .float-group:before, .float-group:after { content: " "; display: table; }
.clearfix:after, .float-group:after { clear: both; }

*:not(pre) > code { font-size: 0.9375em; font-style: normal !important; letter-spacing: 0; padding: 0.1em 0.5ex; word-spacing: -0.15em; background-color: #f7f7f8; -webkit-border-radius: 4px; border-radius: 4px; line-height: 1.45; text-rendering: optimizeSpeed; }

pre, pre > code { line-height: 1.45; color: rgba(0, 0, 0, 0.9); font-family: "Droid Sans Mono", "DejaVu Sans Mono", "Monospace", monospace; font-weight: normal; text-rendering: optimizeSpeed; }

.keyseq { color: rgba(51, 51, 51, 0.8); }

kbd { font-family: "Droid Sans Mono", "DejaVu Sans Mono", monospace; display: inline-block; color: rgba(0, 0, 0, 0.8); font-size: 0.65em; line-height: 1.45; background-color: #f7f7f7; border: 1px solid #ccc; -webkit-border-radius: 3px; border-radius: 3px; -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em white inset; margin: 0 0.15em; padding: 0.2em 0.5em; vertical-align: middle; position: relative; top: -0.1em; white-space: nowrap; }

.keyseq kbd:first-child { margin-left: 0; }

.keyseq kbd:last-child { margin-right: 0; }

.menuseq, .menu { color: rgba(0, 0, 0, 0.8); }

b.button:before, b.button:after { position: relative; top: -1px; font-weight: normal; }

b.button:before { content: "["; padding: 0 3px 0 2px; }

b.button:after { content: "]"; padding: 0 2px 0 3px; }

p a > code:hover { color: rgba(0, 0, 0, 0.9); }

#header, #content, #footnotes, #footer { width: 100%; margin-left: auto; margin-right: auto; margin-top: 0; margin-bottom: 0; max-width: 62.5em; *zoom: 1; position: relative; padding-left: 0.9375em; padding-right: 0.9375em; }
#header:before, #header:after, #content:before, #content:after, #footnotes:before, #footnotes:after, #footer:before, #footer:after { content: " "; display: table; }
#header:after, #content:after, #footnotes:after, #footer:after { clear: both; }

#content { margin-top: 1.25em; }

#content:before { content: none; }

#header > h1:first-child { color: rgba(0, 0, 0, 0.85); margin-top: 2.25rem; margin-bottom: 0; }
#header > h1:first-child + #toc { margin-top: 8px; border-top: 1px solid #ddddd8; }
#header > h1:only-child, body.toc2 #header > h1:nth-last-child(2) { border-bottom: 1px solid #ddddd8; padding-bottom: 8px; }
#header .details { border-bottom: 1px solid #ddddd8; line-height: 1.45; padding-top: 0.25em; padding-bottom: 0.25em; padding-left: 0.25em; color: rgba(0, 0, 0, 0.6); display: -ms-flexbox; display: -webkit-flex; display: flex; -ms-flex-flow: row wrap; -webkit-flex-flow: row wrap; flex-flow: row wrap; }
#header .details span:first-child { margin-left: -0.125em; }
#header .details span.email a { color: rgba(0, 0, 0, 0.85); }
#header .details br { display: none; }
#header .details br + span:before { content: "\00a0\2013\00a0"; }
#header .details br + span.author:before { content: "\00a0\22c5\00a0"; color: rgba(0, 0, 0, 0.85); }
#header .details br + span#revremark:before { content: "\00a0|\00a0"; }
#header #revnumber { text-transform: capitalize; }
#header #revnumber:after { content: "\00a0"; }

#content > h1:first-child:not([class]) { color: rgba(0, 0, 0, 0.85); border-bottom: 1px solid #ddddd8; padding-bottom: 8px; margin-top: 0; padding-top: 1rem; margin-bottom: 1.25rem; }

#toc { border-bottom: 1px solid #efefed; padding-bottom: 0.5em; }
#toc > ul { margin-left: 0.125em; }
#toc ul.sectlevel0 > li > a { font-style: italic; }
#toc ul.sectlevel0 ul.sectlevel1 { margin: 0.5em 0; }
#toc ul { font-family: "Open Sans", "DejaVu Sans", sans-serif; list-style-type: none; }
#toc li { line-height: 1.3334; margin-top: 0.3334em; }
#toc a { text-decoration: none; }
#toc a:active { text-decoration: underline; }

#toctitle { color: #7a2518; font-size: 1.2em; }

@media only screen and (min-width: 768px) { #toctitle { font-size: 1.375em; }
  body.toc2 { padding-left: 15em; padding-right: 0; }
  #toc.toc2 { margin-top: 0 !important; background-color: #f8f8f7; position: fixed; width: 15em; left: 0; top: 0; border-right: 1px solid #efefed; border-top-width: 0 !important; border-bottom-width: 0 !important; z-index: 1000; padding: 1.25em 1em; height: 100%; overflow: auto; }
  #toc.toc2 #toctitle { margin-top: 0; margin-bottom: 0.8rem; font-size: 1.2em; }
  #toc.toc2 > ul { font-size: 0.9em; margin-bottom: 0; }
  #toc.toc2 ul ul { margin-left: 0; padding-left: 1em; }
  #toc.toc2 ul.sectlevel0 ul.sectlevel1 { padding-left: 0; margin-top: 0.5em; margin-bottom: 0.5em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 15em; }
  body.toc2.toc-right #toc.toc2 { border-right-width: 0; border-left: 1px solid #efefed; left: auto; right: 0; } }
@media only screen and (min-width: 1280px) { body.toc2 { padding-left: 20em; padding-right: 0; }
  #toc.toc2 { width: 20em; }
  #toc.toc2 #toctitle { font-size: 1.375em; }
  #toc.toc2 > ul { font-size: 0.95em; }
  #toc.toc2 ul ul { padding-left: 1.25em; }
  body.toc2.toc-right { padding-left: 0; padding-right: 20em; } }
#content #toc { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
#content #toc > :first-child { margin-top: 0; }
#content #toc > :last-child { margin-bottom: 0; }

#footer { max-width: 100%; background-color: rgba(0, 0, 0, 0.8); padding: 1.25em; }

#footer-text { color: rgba(255, 255, 255, 0.8); line-height: 1.44; }

.sect1 { padding-bottom: 0.625em; }

@media only screen and (min-width: 768px) { .sect1 { padding-bottom: 1.25em; } }
.sect1 + .sect1 { border-top: 1px solid #efefed; }

#content h1 > a.anchor, h2 > a.anchor, h3 > a.anchor, #toctitle > a.anchor, .sidebarblock > .content > .title > a.anchor, h4 > a.anchor, h5 > a.anchor, h6 > a.anchor { position: absolute; z-index: 1001; width: 1.5ex; margin-left: -1.5ex; display: block; text-decoration: none !important; visibility: hidden; text-align: center; font-weight: normal; }
#content h1 > a.anchor:before, h2 > a.anchor:before, h3 > a.anchor:before, #toctitle > a.anchor:before, .sidebarblock > .content > .title > a.anchor:before, h4 > a.anchor:before, h5 > a.anchor:before, h6 > a.anchor:before { content: "\00A7"; font-size: 0.85em; display: block; padding-top: 0.1em; }
#content h1:hover > a.anchor, #content h1 > a.anchor:hover, h2:hover > a.anchor, h2 > a.anchor:hover, h3:hover > a.anchor, #toctitle:hover > a.anchor, .sidebarblock > .content > .title:hover > a.anchor, h3 > a.anchor:hover, #toctitle > a.anchor:hover, .sidebarblock > .content > .title > a.anchor:hover, h4:hover > a.anchor, h4 > a.anchor:hover, h5:hover > a.anchor, h5 > a.anchor:hover, h6:hover > a.anchor, h6 > a.anchor:hover { visibility: visible; }
#content h1 > a.link, h2 > a.link, h3 > a.link, #toctitle > a.link, .sidebarblock > .content > .title > a.link, h4 > a.link, h5 > a.link, h6 > a.link { color: #ba3925; text-decoration: none; }
#content h1 > a.link:hover, h2 > a.link:hover, h3 > a.link:hover, #toctitle > a.link:hover, .sidebarblock > .content > .title > a.link:hover, h4 > a.link:hover, h5 > a.link:hover, h6 > a.link:hover { color: #a53221; }

.audioblock, .imageblock, .literalblock, .listingblock, .stemblock, .videoblock { margin-bottom: 1.25em; }

.admonitionblock td.content > .title, .audioblock > .title, .exampleblock > .title, .imageblock > .title, .listingblock > .title, .literalblock > .title, .stemblock > .title, .openblock > .title, .paragraph > .title, .quoteblock > .title, table.tableblock > .title, .verseblock > .title, .videoblock > .title, .dlist > .title, .olist > .title, .ulist > .title, .qlist > .title, .hdlist > .title { text-rendering: optimizeLegibility; text-align: left; font-family: "Noto Serif", "DejaVu Serif", serif; font-size: 1rem; font-style: italic; }

table.tableblock > caption.title { white-space: nowrap; overflow: visible; max-width: 0; }

.paragraph.lead > p, #preamble > .sectionbody > .paragraph:first-of-type p { color: rgba(0, 0, 0, 0.85); }

table.tableblock #preamble > .sectionbody > .paragraph:first-of-type p { font-size: inherit; }

.admonitionblock > table { border-collapse: separate; border: 0; background: none; width: 100%; }
.admonitionblock > table td.icon { text-align: center; width: 80px; }
.admonitionblock > table td.icon img { max-width: none; }
.admonitionblock > table td.icon .title { font-weight: bold; font-family: "Open Sans", "DejaVu Sans", sans-serif; text-transform: uppercase; }
.admonitionblock > table td.content { padding-left: 1.125em; padding-right: 1.25em; border-left: 1px solid #ddddd8; color: rgba(0, 0, 0, 0.6); }
.admonitionblock > table td.content > :last-child > :last-child { margin-bottom: 0; }

.exampleblock > .content { border-style: solid; border-width: 1px; border-color: #e6e6e6; margin-bottom: 1.25em; padding: 1.25em; background: white; -webkit-border-radius: 4px; border-radius: 4px; }
.exampleblock > .content > :first-child { margin-top: 0; }
.exampleblock > .content > :last-child { margin-bottom: 0; }

.sidebarblock { border-style: solid; border-width: 1px; border-color: #e0e0dc; margin-bottom: 1.25em; padding: 1.25em; background: #f8f8f7; -webkit-border-radius: 4px; border-radius: 4px; }
.sidebarblock > :first-child { margin-top: 0; }
.sidebarblock > :last-child { margin-bottom: 0; }
.sidebarblock > .content > .title { color: #7a2518; margin-top: 0; text-align: center; }

.exampleblock > .content > :last-child > :last-child, .exampleblock > .content .olist > ol > li:last-child > :last-child, .exampleblock > .content .ulist > ul > li:last-child > :last-child, .exampleblock > .content .qlist > ol > li:last-child > :last-child, .sidebarblock > .content > :last-child > :last-child, .sidebarblock > .content .olist > ol > li:last-child > :last-child, .sidebarblock > .content .ulist > ul > li:last-child > :last-child, .sidebarblock > .content .qlist > ol > li:last-child > :last-child { margin-bottom: 0; }

.literalblock pre, .listingblock pre:not(.highlight), .listingblock pre[class="highlight"], .listingblock pre[class^="highlight "], .listingblock pre.CodeRay, .listingblock pre.prettyprint { background: #f7f7f8; }
.sidebarblock .literalblock pre, .sidebarblock .listingblock pre:not(.highlight), .sidebarblock .listingblock pre[class="highlight"], .sidebarblock .listingblock pre[class^="highlight "], .sidebarblock .listingblock pre.CodeRay, .sidebarblock .listingblock pre.prettyprint { background: #f2f1f1; }

.literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { -webkit-border-radius: 4px; border-radius: 4px; word-wrap: break-word; padding: 1em; font-size: 0.8125em; }
.literalblock pre.nowrap, .literalblock pre[class].nowrap, .listingblock pre.nowrap, .listingblock pre[class].nowrap { overflow-x: auto; white-space: pre; word-wrap: normal; }
@media only screen and (min-width: 768px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 0.90625em; } }
@media only screen and (min-width: 1280px) { .literalblock pre, .literalblock pre[class], .listingblock pre, .listingblock pre[class] { font-size: 1em; } }

.literalblock.output pre { color: #f7f7f8; background-color: rgba(0, 0, 0, 0.9); }

.listingblock pre.highlightjs { padding: 0; }
.listingblock pre.highlightjs > code { padding: 1em; -webkit-border-radius: 4px; border-radius: 4px; }

.listingblock pre.prettyprint { border-width: 0; }

.listingblock > .content { position: relative; }

.listingblock code[data-lang]:before { display: none; content: attr(data-lang); position: absolute; font-size: 0.75em; top: 0.425rem; right: 0.5rem; line-height: 1; text-transform: uppercase; color: #999; }

.listingblock:hover code[data-lang]:before { display: block; }

.listingblock.terminal pre .command:before { content: attr(data-prompt); padding-right: 0.5em; color: #999; }

.listingblock.terminal pre .command:not([data-prompt]):before { content: "$"; }

table.pyhltable { border-collapse: separate; border: 0; margin-bottom: 0; background: none; }

table.pyhltable td { vertical-align: top; padding-top: 0; padding-bottom: 0; line-height: 1.45; }

table.pyhltable td.code { padding-left: .75em; padding-right: 0; }

pre.pygments .lineno, table.pyhltable td:not(.code) { color: #999; padding-left: 0; padding-right: .5em; border-right: 1px solid #ddddd8; }

pre.pygments .lineno { display: inline-block; margin-right: .25em; }

table.pyhltable .linenodiv { background: none !important; padding-right: 0 !important; }

.quoteblock { margin: 0 1em 1.25em 1.5em; display: table; }
.quoteblock > .title { margin-left: -1.5em; margin-bottom: 0.75em; }
.quoteblock blockquote, .quoteblock blockquote p { color: rgba(0, 0, 0, 0.85); font-size: 1.15rem; line-height: 1.75; word-spacing: 0.1em; letter-spacing: 0; font-style: italic; text-align: justify; }
.quoteblock blockquote { margin: 0; padding: 0; border: 0; }
.quoteblock blockquote:before { content: "\201c"; float: left; font-size: 2.75em; font-weight: bold; line-height: 0.6em; margin-left: -0.6em; color: #7a2518; text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1); }
.quoteblock blockquote > .paragraph:last-child p { margin-bottom: 0; }
.quoteblock .attribution { margin-top: 0.5em; margin-right: 0.5ex; text-align: right; }
.quoteblock .quoteblock { margin-left: 0; margin-right: 0; padding: 0.5em 0; border-left: 3px solid rgba(0, 0, 0, 0.6); }
.quoteblock .quoteblock blockquote { padding: 0 0 0 0.75em; }
.quoteblock .quoteblock blockquote:before { display: none; }

.verseblock { margin: 0 1em 1.25em 1em; }
.verseblock pre { font-family: "Open Sans", "DejaVu Sans", sans; font-size: 1.15rem; color: rgba(0, 0, 0, 0.85); font-weight: 300; text-rendering: optimizeLegibility; }
.verseblock pre strong { font-weight: 400; }
.verseblock .attribution { margin-top: 1.25rem; margin-left: 0.5ex; }

.quoteblock .attribution, .verseblock .attribution { font-size: 0.9375em; line-height: 1.45; font-style: italic; }
.quoteblock .attribution br, .verseblock .attribution br { display: none; }
.quoteblock .attribution cite, .verseblock .attribution cite { display: block; letter-spacing: -0.025em; color: rgba(0, 0, 0, 0.6); }

.quoteblock.abstract { margin: 0 0 1.25em 0; display: block; }
.quoteblock.abstract blockquote, .quoteblock.abstract blockquote p { text-align: left; word-spacing: 0; }
.quoteblock.abstract blockquote:before, .quoteblock.abstract blockquote p:first-of-type:before { display: none; }

table.tableblock { max-width: 100%; border-collapse: separate; }
table.tableblock td > .paragraph:last-child p > p:last-child, table.tableblock th > p:last-child, table.tableblock td > p:last-child { margin-bottom: 0; }

table.tableblock, th.tableblock, td.tableblock { border: 0 solid #dedede; }

table.grid-all th.tableblock, table.grid-all td.tableblock { border-width: 0 1px 1px 0; }

table.grid-all tfoot > tr > th.tableblock, table.grid-all tfoot > tr > td.tableblock { border-width: 1px 1px 0 0; }

table.grid-cols th.tableblock, table.grid-cols td.tableblock { border-width: 0 1px 0 0; }

table.grid-all * > tr > .tableblock:last-child, table.grid-cols * > tr > .tableblock:last-child { border-right-width: 0; }

table.grid-rows th.tableblock, table.grid-rows td.tableblock { border-width: 0 0 1px 0; }

table.grid-all tbody > tr:last-child > th.tableblock, table.grid-all tbody > tr:last-child > td.tableblock, table.grid-all thead:last-child > tr > th.tableblock, table.grid-rows tbody > tr:last-child > th.tableblock, table.grid-rows tbody > tr:last-child > td.tableblock, table.grid-rows thead:last-child > tr > th.tableblock { border-bottom-width: 0; }

table.grid-rows tfoot > tr > th.tableblock, table.grid-rows tfoot > tr > td.tableblock { border-width: 1px 0 0 0; }

table.frame-all { border-width: 1px; }

table.frame-sides { border-width: 0 1px; }

table.frame-topbot { border-width: 1px 0; }

th.halign-left, td.halign-left { text-align: left; }

th.halign-right, td.halign-right { text-align: right; }

th.halign-center, td.halign-center { text-align: center; }

th.valign-top, td.valign-top { vertical-align: top; }

th.valign-bottom, td.valign-bottom { vertical-align: bottom; }

th.valign-middle, td.valign-middle { vertical-align: middle; }

table thead th, table tfoot th { font-weight: bold; }

tbody tr th { display: table-cell; line-height: 1.6; background: #f7f8f7; }

tbody tr th, tbody tr th p, tfoot tr th, tfoot tr th p { color: rgba(0, 0, 0, 0.8); font-weight: bold; }

p.tableblock > code:only-child { background: none; padding: 0; }

p.tableblock { font-size: 1em; }

td > div.verse { white-space: pre; }

ol { margin-left: 1.75em; }

ul li ol { margin-left: 1.5em; }

dl dd { margin-left: 1.125em; }

dl dd:last-child, dl dd:last-child > :last-child { margin-bottom: 0; }

ol > li p, ul > li p, ul dd, ol dd, .olist .olist, .ulist .ulist, .ulist .olist, .olist .ulist { margin-bottom: 0.625em; }

ul.unstyled, ol.unnumbered, ul.checklist, ul.none { list-style-type: none; }

ul.unstyled, ol.unnumbered, ul.checklist { margin-left: 0.625em; }

ul.checklist li > p:first-child > .fa-square-o:first-child, ul.checklist li > p:first-child > .fa-check-square-o:first-child { width: 1em; font-size: 0.85em; }

ul.checklist li > p:first-child > input[type="checkbox"]:first-child { width: 1em; position: relative; top: 1px; }

ul.inline { margin: 0 auto 0.625em auto; margin-left: -1.375em; margin-right: 0; padding: 0; list-style: none; overflow: hidden; }
ul.inline > li { list-style: none; float: left; margin-left: 1.375em; display: block; }
ul.inline > li > * { display: block; }

.unstyled dl dt { font-weight: normal; font-style: normal; }

ol.arabic { list-style-type: decimal; }

ol.decimal { list-style-type: decimal-leading-zero; }

ol.loweralpha { list-style-type: lower-alpha; }

ol.upperalpha { list-style-type: upper-alpha; }

ol.lowerroman { list-style-type: lower-roman; }

ol.upperroman { list-style-type: upper-roman; }

ol.lowergreek { list-style-type: lower-greek; }

.hdlist > table, .colist > table { border: 0; background: none; }
.hdlist > table > tbody > tr, .colist > table > tbody > tr { background: none; }

td.hdlist1, td.hdlist2 { vertical-align: top; padding: 0 0.625em; }

td.hdlist1 { font-weight: bold; padding-bottom: 1.25em; }

.literalblock + .colist, .listingblock + .colist { margin-top: -0.5em; }

.colist > table tr > td:first-of-type { padding: 0 0.75em; line-height: 1; }
.colist > table tr > td:last-of-type { padding: 0.25em 0; }

.thumb, .th { line-height: 0; display: inline-block; border: solid 4px white; -webkit-box-shadow: 0 0 0 1px #dddddd; box-shadow: 0 0 0 1px #dddddd; }

.imageblock.left, .imageblock[style*="float: left"] { margin: 0.25em 0.625em 1.25em 0; }
.imageblock.right, .imageblock[style*="float: right"] { margin: 0.25em 0 1.25em 0.625em; }
.imageblock > .title { margin-bottom: 0; }
.imageblock.thumb, .imageblock.th { border-width: 6px; }
.imageblock.thumb > .title, .imageblock.th > .title { padding: 0 0.125em; }

.image.left, .image.right { margin-top: 0.25em; margin-bottom: 0.25em; display: inline-block; line-height: 0; }
.image.left { margin-right: 0.625em; }
.image.right { margin-left: 0.625em; }

a.image { text-decoration: none; display: inline-block; }
a.image object { pointer-events: none; }

sup.footnote, sup.footnoteref { font-size: 0.875em; position: static; vertical-align: super; }
sup.footnote a, sup.footnoteref a { text-decoration: none; }
sup.footnote a:active, sup.footnoteref a:active { text-decoration: underline; }

#footnotes { padding-top: 0.75em; padding-bottom: 0.75em; margin-bottom: 0.625em; }
#footnotes hr { width: 20%; min-width: 6.25em; margin: -0.25em 0 0.75em 0; border-width: 1px 0 0 0; }
#footnotes .footnote { padding: 0 0.375em 0 0.225em; line-height: 1.3334; font-size: 0.875em; margin-left: 1.2em; text-indent: -1.05em; margin-bottom: 0.2em; }
#footnotes .footnote a:first-of-type { font-weight: bold; text-decoration: none; }
#footnotes .footnote:last-of-type { margin-bottom: 0; }

#content #footnotes { margin-top: -0.625em; margin-bottom: 0; padding: 0.75em 0; }

.gist .file-data > table { border: 0; background: #fff; width: 100%; margin-bottom: 0; }
.gist .file-data > table td.line-data { width: 99%; }

div.unbreakable { page-break-inside: avoid; }

.big { font-size: larger; }

.small { font-size: smaller; }

.underline { text-decoration: underline; }

.overline { text-decoration: overline; }

.line-through { text-decoration: line-through; }

.aqua { color: #00bfbf; }

.aqua-background { background-color: #00fafa; }

.black { color: black; }

.black-background { background-color: black; }

.blue { color: #0000bf; }

.blue-background { background-color: #0000fa; }

.fuchsia { color: #bf00bf; }

.fuchsia-background { background-color: #fa00fa; }

.gray { color: #606060; }

.gray-background { background-color: #7d7d7d; }

.green { color: #006000; }

.green-background { background-color: #007d00; }

.lime { color: #00bf00; }

.lime-background { background-color: #00fa00; }

.maroon { color: #600000; }

.maroon-background { background-color: #7d0000; }

.navy { color: #000060; }

.navy-background { background-color: #00007d; }

.olive { color: #606000; }

.olive-background { background-color: #7d7d00; }

.purple { color: #600060; }

.purple-background { background-color: #7d007d; }

.red { color: #bf0000; }

.red-background { background-color: #fa0000; }

.silver { color: #909090; }

.silver-background { background-color: #bcbcbc; }

.teal { color: #006060; }

.teal-background { background-color: #007d7d; }

.white { color: #bfbfbf; }

.white-background { background-color: #fafafa; }

.yellow { color: #bfbf00; }

.yellow-background { background-color: #fafa00; }

span.icon > .fa { cursor: default; }

.admonitionblock td.icon [class^="fa icon-"] { font-size: 2.5em; text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5); cursor: default; }
.admonitionblock td.icon .icon-note:before { content: "\f05a"; color: #19407c; }
.admonitionblock td.icon .icon-tip:before { content: "\f0eb"; text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8); color: #111; }
.admonitionblock td.icon .icon-warning:before { content: "\f071"; color: #bf6900; }
.admonitionblock td.icon .icon-caution:before { content: "\f06d"; color: #bf3400; }
.admonitionblock td.icon .icon-important:before { content: "\f06a"; color: #bf0000; }

.conum[data-value] { display: inline-block; color: #fff !important; background-color: rgba(0, 0, 0, 0.8); -webkit-border-radius: 100px; border-radius: 100px; text-align: center; font-size: 0.75em; width: 1.67em; height: 1.67em; line-height: 1.67em; font-family: "Open Sans", "DejaVu Sans", sans-serif; font-style: normal; font-weight: bold; }
.conum[data-value] * { color: #fff !important; }
.conum[data-value] + b { display: none; }
.conum[data-value]:after { content: attr(data-value); }
pre .conum[data-value] { position: relative; top: -0.125em; }

b.conum * { color: inherit !important; }

.conum:not([data-value]):empty { display: none; }

dt, th.tableblock, td.content, div.footnote { text-rendering: optimizeLegibility; }

h1, h2, p, td.content, span.alt { letter-spacing: -0.01em; }

p strong, td.content strong, div.footnote strong { letter-spacing: -0.005em; }

p, blockquote, dt, td.content, span.alt { font-size: 1.0625rem; }

p { margin-bottom: 1.25rem; }

.sidebarblock p, .sidebarblock dt, .sidebarblock td.content, p.tableblock { font-size: 1em; }

.exampleblock > .content { background-color: #fffef7; border-color: #e0e0dc; -webkit-box-shadow: 0 1px 4px #e0e0dc; box-shadow: 0 1px 4px #e0e0dc; }

.print-only { display: none !important; }

@media print { @page { margin: 1.25cm 0.75cm; }
  * { -webkit-box-shadow: none !important; box-shadow: none !important; text-shadow: none !important; }
  a { color: inherit !important; text-decoration: underline !important; }
  a.bare, a[href^="#"], a[href^="mailto:"] { text-decoration: none !important; }
  a[href^="http:"]:not(.bare):after, a[href^="https:"]:not(.bare):after { content: "(" attr(href) ")"; display: inline-block; font-size: 0.875em; padding-left: 0.25em; }
  abbr[title]:after { content: " (" attr(title) ")"; }
  pre, blockquote, tr, img, object, svg { page-break-inside: avoid; }
  thead { display: table-header-group; }
  svg { max-width: 100%; }
  p, blockquote, dt, td.content { font-size: 1em; orphans: 3; widows: 3; }
  h2, h3, #toctitle, .sidebarblock > .content > .title, #toctitle, .sidebarblock > .content > .title { page-break-after: avoid; }
  #toc, .sidebarblock, .exampleblock > .content { background: none !important; }
  #toc { border-bottom: 1px solid #ddddd8 !important; padding-bottom: 0 !important; }
  .sect1 { padding-bottom: 0 !important; }
  .sect1 + .sect1 { border: 0 !important; }
  #header > h1:first-child { margin-top: 1.25rem; }
  body.book #header { text-align: center; }
  body.book #header > h1:first-child { border: 0 !important; margin: 2.5em 0 1em 0; }
  body.book #header .details { border: 0 !important; display: block; padding: 0 !important; }
  body.book #header .details span:first-child { margin-left: 0 !important; }
  body.book #header .details br { display: block; }
  body.book #header .details br + span:before { content: none !important; }
  body.book #toc { border: 0 !important; text-align: left !important; padding: 0 !important; margin: 0 !important; }
  body.book #toc, body.book #preamble, body.book h1.sect0, body.book .sect1 > h2 { page-break-before: always; }
  .listingblock code[data-lang]:before { display: block; }
  #footer { background: none !important; padding: 0 0.9375em; }
  #footer-text { color: rgba(0, 0, 0, 0.6) !important; font-size: 0.9em; }
  .hide-on-print { display: none !important; }
  .print-only { display: block !important; }
  .hide-for-print { display: none !important; }
  .show-for-print { display: inherit !important; } }

</style>
<link rel="stylesheet" href="css/font-awesome.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>系统工程师实战</h1>
<div class="details">
<span id="author" class="author">&lt;wangpeng20199@gmail.com&gt;</span><br>
</div>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_前言">前言</a>
<ul class="sectlevel2">
<li><a href="#_贡献名单">贡献名单</a></li>
</ul>
</li>
<li><a href="#_Zabbix_chapter">1. Zabbix</a>
<ul class="sectlevel2">
<li><a href="#_zabbix">1.1. zabbix</a>
<ul class="sectlevel3">
<li><a href="#_安装">1.1.1. 安装</a></li>
<li><a href="#_配置_mysql_数据库">1.1.2. 配置 <code>mysql</code> 数据库</a></li>
<li><a href="#_配置服务器">1.1.3. 配置服务器</a></li>
<li><a href="#_添加客户端">1.1.4. 添加客户端</a></li>
<li><a href="#_配置客户端">1.1.5. 配置客户端</a></li>
<li><a href="#_启动服务">1.1.6. 启动服务</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Gitlab_chapter">2. Gitlab</a>
<ul class="sectlevel2">
<li><a href="#_gitlab">2.1. Gitlab</a>
<ul class="sectlevel3">
<li><a href="#_下载安装">2.1.1. 下载安装</a></li>
<li><a href="#_初始化">2.1.2. 初始化</a></li>
<li><a href="#_修改配置">2.1.3. 修改配置</a></li>
<li><a href="#_用户设置">2.1.4. 用户设置</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Jenkins_chapter">3. Jenkins</a>
<ul class="sectlevel2">
<li><a href="#_jenkins">3.1. Jenkins</a>
<ul class="sectlevel3">
<li><a href="#_下载安装_2">3.1.1. 下载安装</a></li>
<li><a href="#_启动">3.1.2. 启动</a></li>
<li><a href="#_初始化_2">3.1.3. 初始化</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Mysql_chapter">4. Mysql</a>
<ul class="sectlevel2">
<li><a href="#_web_备份迁移">4.1. <code>web</code> 备份迁移</a>
<ul class="sectlevel3">
<li><a href="#_mysql_备份还原">4.1.1. <code>mysql</code> 备份还原</a></li>
<li><a href="#_web_文件备份">4.1.2. <code>web</code> 文件备份</a></li>
<li><a href="#_命令参数解释">4.1.3. 命令参数解释</a>
<ul class="sectlevel4">
<li><a href="#_mysqldump">mysqldump</a></li>
<li><a href="#_mysql">mysql</a></li>
</ul>
</li>
<li><a href="#_tar">4.1.4. tar</a></li>
<li><a href="#_rsync">4.1.5. rsync</a></li>
<li><a href="#_crontab">4.1.6. crontab</a></li>
</ul>
</li>
<li><a href="#_mysql_主从">4.2. <code>Mysql</code> 主从</a>
<ul class="sectlevel3">
<li><a href="#_gtid主从配置">4.2.1. GTID主从配置</a></li>
</ul>
</li>
<li><a href="#_mycat">4.3. Mycat</a>
<ul class="sectlevel3">
<li><a href="#_安装_mycat">4.3.1. 安装 <code>mycat</code></a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Centos_chapter">5. Centos</a>
<ul class="sectlevel2">
<li><a href="#_centos7初始化">5.1. Centos7初始化</a></li>
<li><a href="#_centos7_install_lnmp">5.2. CentOS7 Install LNMP</a>
<ul class="sectlevel3">
<li><a href="#_安装_nginx">5.2.1. 安装 Nginx</a></li>
<li><a href="#_安装_mysql">5.2.2. 安装 MySQL</a></li>
<li><a href="#_安装_php7">5.2.3. 安装 PHP7</a></li>
<li><a href="#_lnmp_环境测试">5.2.4. LNMP 环境测试</a></li>
</ul>
</li>
<li><a href="#_centos8lnmp">5.3. Centos8LNMP</a>
<ul class="sectlevel3">
<li><a href="#_安装nginx">5.3.1. 安装Nginx</a></li>
<li><a href="#_安装_mysql_2">5.3.2. 安装 MySQL</a></li>
<li><a href="#_安装php7">5.3.3. 安装PHP7</a></li>
<li><a href="#_lnmp环境测试">5.3.4. LNMP环境测试</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_XXL-JOB_chapter">6. XXL-JOB</a>
<ul class="sectlevel2">
<li><a href="#_安装配置">6.1. 安装配置</a>
<ul class="sectlevel3">
<li><a href="#_安装依赖">6.1.1. 安装依赖</a>
<ul class="sectlevel4">
<li><a href="#_git">Git</a></li>
<li><a href="#_maven_java_8">Maven &amp;&amp; Java 8</a></li>
<li><a href="#_java_11可选">Java 11（可选）</a></li>
<li><a href="#_mysql_2">MySQL</a></li>
</ul>
</li>
<li><a href="#_xxl_job_安装">6.1.2. XXL-JOB 安装</a></li>
<li><a href="#_xxl_job_运行前">6.1.3. XXL-JOB 运行前</a>
<ul class="sectlevel4">
<li><a href="#_xxl_job_服务端">XXL-JOB 服务端</a>
<ul class="sectlevel5">
<li><a href="#_mysql配置">MySQL配置</a></li>
<li><a href="#_设置配置文件">设置配置文件</a></li>
<li><a href="#_创建系统用户">创建系统用户</a></li>
<li><a href="#_增加_systemd_文件">增加 systemd 文件</a></li>
</ul>
</li>
<li><a href="#_xxl_job_客户端">XXL-JOB 客户端</a>
<ul class="sectlevel5">
<li><a href="#_创建目录">创建目录</a></li>
<li><a href="#_设置配置文件_2">设置配置文件</a></li>
<li><a href="#_创建系统用户_2">创建系统用户</a></li>
<li><a href="#_增加_systemd_文件_2">增加 systemd 文件</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_启动_xxl_job_服务端">6.1.4. 启动 XXL-JOB 服务端</a></li>
<li><a href="#_启动_xxl_job_客户端">6.1.5. 启动 XXL-JOB 客户端</a></li>
<li><a href="#_工作状态确认">6.1.6. 工作状态确认</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Kvm_chapter">7. Kvm</a>
<ul class="sectlevel2">
<li><a href="#_安装配置_2">7.1. 安装配置</a>
<ul class="sectlevel3">
<li><a href="#_安装kvm环境">7.1.1. 安装kvm环境</a></li>
<li><a href="#_设置网桥">7.1.2. 设置网桥</a>
<ul class="sectlevel4">
<li><a href="#_设置内网网桥和_dhcp">设置内网网桥和 DHCP</a></li>
<li><a href="#_查看默认网桥virbr0">查看默认网桥virbr0</a></li>
</ul>
</li>
<li><a href="#_配置公网网桥使虚拟机可以绑定公网ip">7.1.3. 配置公网网桥，使虚拟机可以绑定公网IP</a></li>
</ul>
</li>
<li><a href="#_kvm虚拟机">7.2. KVM虚拟机</a>
<ul class="sectlevel3">
<li><a href="#_挂载硬盘">7.2.1. 挂载硬盘</a></li>
<li><a href="#_虚拟机安装">7.2.2. 虚拟机安装</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Service_chapter">8. Service</a>
<ul class="sectlevel2">
<li><a href="#_systemd">8.1. systemd</a>
<ul class="sectlevel3">
<li><a href="#_service_文件">8.1.1. <code>.service</code> 文件</a></li>
<li><a href="#_timer_定时器文件">8.1.2. <code>.timer</code> 定时器文件</a></li>
<li><a href="#_启动_service">8.1.3. 启动 <code>service</code></a></li>
<li><a href="#_启动_timer_服务">8.1.4. 启动 <code>timer</code> 服务</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Python38_chapter">9. Python38</a>
<ul class="sectlevel2">
<li><a href="#_centos7_install_python38">9.1. CentOS7 Install Python38</a>
<ul class="sectlevel3">
<li><a href="#_二进制压缩包安装">9.1.1. 二进制压缩包安装</a></li>
</ul>
</li>
<li><a href="#_centos8_install_python38">9.2. CentOS8 Install Python38</a>
<ul class="sectlevel3">
<li><a href="#_二进制压缩包安装_2">9.2.1. 二进制压缩包安装</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Java_chapter">10. Java</a>
<ul class="sectlevel2">
<li><a href="#_maven_安装">10.1. <code>maven</code> 安装</a></li>
<li><a href="#_nodejs_安装">10.2. <code>nodejs</code> 安装</a></li>
</ul>
</li>
<li><a href="#_DNS_chapter">11. DNS</a>
<ul class="sectlevel2">
<li><a href="#_dns_服务搭建">11.1. <code>DNS</code> 服务搭建</a></li>
</ul>
</li>
<li><a href="#_Docker_chapter">12. Docker</a>
<ul class="sectlevel2">
<li><a href="#_docker">12.1. <code>Docker</code></a>
<ul class="sectlevel3">
<li><a href="#_安装_2">12.1.1. 安装</a></li>
<li><a href="#_常用命令">12.1.2. 常用命令</a></li>
<li><a href="#_dockerfile_定制镜像">12.1.3. <code>Dockerfile</code> 定制镜像</a></li>
<li><a href="#_docker仓库">12.1.4. Docker仓库</a></li>
<li><a href="#_数据管理">12.1.5. 数据管理</a></li>
<li><a href="#_外部访问容器">12.1.6. 外部访问容器</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_Ansible_chapter">13. Ansible</a>
<ul class="sectlevel2">
<li><a href="#_ansible">13.1. Ansible</a>
<ul class="sectlevel3">
<li><a href="#_安装_3">13.1.1. 安装</a></li>
</ul>
</li>
<li><a href="#_ssh秘钥认证">13.2. SSH秘钥认证</a></li>
<li><a href="#_添加被管理主机">13.3. 添加被管理主机</a></li>
<li><a href="#_ansible常用模块">13.4. ansible常用模块</a></li>
<li><a href="#_ansible_playbook">13.5. ansible-playbook</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_前言">前言</h2>
<div class="sectionbody">
<div class="paragraph">
<p>一本关于个人成长、软件开发、系统运维、思维、思考的杂记。</p>
</div>
<div class="sect2">
<h3 id="_贡献名单">贡献名单</h3>
<div class="paragraph">
<p><strong>按时间先后</strong></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Zabbix_chapter">1. Zabbix</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>基于 CentOS 7</strong></p>
</div>
<div class="sect2">
<h3 id="_zabbix">1.1. zabbix</h3>
<div class="sect3">
<h4 id="_安装">1.1.1. 安装</h4>
<div class="paragraph">
<div class="title">增加 zabbix <code>yum</code> 源</div>
<p><code>rpm -Uvh <a href="https://repo.zabbix.com/zabbix/4.4/rhel/7/x86_64/zabbix-release-4.4-1.el7.noarch.rpm" class="bare">https://repo.zabbix.com/zabbix/4.4/rhel/7/x86_64/zabbix-release-4.4-1.el7.noarch.rpm</a></code><br>
<code>yum -y install zabbix-server-mysql zabbix-web-mysql zabbix-apache-conf zabbix-agent</code></p>
</div>
<div class="listingblock">
<div class="title">查看安装的软件包</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@redas_core ~]# rpm -aq |grep zabbix
zabbix-web-mysql-4.4.4-1.el7.noarch
zabbix-get-4.4.4-1.el7.x86_64
zabbix-server-mysql-4.4.4-1.el7.x86_64
zabbix-agent-4.4.4-1.el7.x86_64
zabbix-release-4.4-1.el7.noarch
zabbix-web-4.4.4-1.el7.noarch</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">增加开机启动</div>
<p><code>systemctl enable zabbix-server</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_配置_mysql_数据库">1.1.2. 配置 <code>mysql</code> 数据库</h4>
<div class="paragraph">
<div class="title">创建数据库</div>
<p><code>CREATE DATABASE zabbix DEFAULT CHARACTER SET utf8mb4 DEFAULT COLLATE utf8mb4_unicode_ci;</code></p>
</div>
<div class="listingblock">
<div class="title">查看数据库</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">mysql&gt; show databases;
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| redas              |
| sys                |
| zabbix             |
+--------------------+</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">新建用户</div>
<p><code>mysql -uroot -pgeek -e "CREATE USER zabbix@localhost identified with mysql_native_password by 'geek';"</code><br>
<code>mysql -uroot -pgeek -e "GRANT ALL ON zabbix.* TO 'zabbix'@'localhost' WITH GRANT OPTION;"</code></p>
</div>
<div class="listingblock">
<div class="title">查看用户</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@redas_core ~]# mysql -uzabbix -pgeek zabbix -e "show tables"
+----------------------------+
| Tables_in_zabbix           |
+----------------------------+
| acknowledges               |
| actions                    |
| alerts                     |
...</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">导入 <code>zabbix</code> 数据</div>
<p><code>gzip -d /usr/share/doc/zabbix-server-mysql-4.4.4/create.sql.gz</code><br>
<code>mysql -uzabbix -pgeek zabbix &lt; /usr/share/doc/zabbix-server-mysql-4.4.4/create.sql</code></p>
</div>
<div class="listingblock">
<div class="title">查看导入数据</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">mysql&gt; show tables;
+----------------------------+
| Tables_in_zabbix           |
+----------------------------+
| acknowledges               |
| actions                    |
| alerts                     |
...</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配置服务器">1.1.3. 配置服务器</h4>
<div class="paragraph">
<div class="title">编辑 <code>/etc/zabbix/zabbix_server.conf</code> 文件</div>
<p><code>sed -i '124s/# DBPassword=/DBPassword=geek/' /etc/zabbix/zabbix_server.conf</code></p>
</div>
<div class="paragraph">
<div class="title">添加时区</div>
<p><code>sed -i '20s@        # php_value date.timezone Europe/Riga@php_value date.timezone Asia/Shanghai@' /etc/httpd/conf.d/zabbix.conf</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_添加客户端">1.1.4. 添加客户端</h4>
<div class="paragraph">
<div class="title">增加 zabbix <code>yum</code> 源</div>
<p><code>rpm -Uvh <a href="https://repo.zabbix.com/zabbix/4.4/rhel/7/x86_64/zabbix-release-4.4-1.el7.noarch.rpm" class="bare">https://repo.zabbix.com/zabbix/4.4/rhel/7/x86_64/zabbix-release-4.4-1.el7.noarch.rpm</a></code><br>
<code>yum -y install  zabbix-agent</code></p>
</div>
<div class="paragraph">
<div class="title">增加开机启动</div>
<p><code>systemctl enable zabbix-agent</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_配置客户端">1.1.5. 配置客户端</h4>
<div class="paragraph">
<div class="title">设置主机ip和客户端名称</div>
<p><code>sed -i '98s/Server=/Server=192.168.2.8/' /etc/zabbix/zabbix_agentd.conf</code><br>
<code>sed -i '139s/ServerActive=/ServerActive=192.168.2.8/' /etc/zabbix/zabbix_agentd.conf</code><br>
<code>sed -i '150s/Hostname=/Hostname=yinxin/' /etc/zabbix/zabbix_agentd.conf</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_启动服务">1.1.6. 启动服务</h4>
<div class="paragraph">
<div class="title">服务端</div>
<p><code>systemctl start zabbix-server</code></p>
</div>
<div class="paragraph">
<div class="title">客户端</div>
<p><code>systemctl start zabbix-server</code></p>
</div>
<div class="paragraph">
<div class="title">查看服务状态</div>
<p><code>systemctl status zabbix-server</code></p>
</div>
<div class="paragraph">
<div class="title">浏览器访问</div>
<p><code><a href="http://192.168.2.8/zabbix/setup.php" class="bare">http://192.168.2.8/zabbix/setup.php</a></code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
解决中文乱码<br>
将windows /Windows/fonts/simkai.ttf 拷贝到服务器 /usr/share/zabbix/assets/fonts目录下<br>
将/usr/share/zabbix/include/defines.inc.php文件下的graphfont替换为 simkai
</td>
</tr>
</table>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Gitlab_chapter">2. Gitlab</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>基于 CentOS 7</strong></p>
</div>
<div class="sect2">
<h3 id="_gitlab">2.1. Gitlab</h3>
<div class="sect3">
<h4 id="_下载安装">2.1.1. 下载安装</h4>
<div class="paragraph">
<div class="title">官方下载RPM包</div>
<p><code>wget <a href="https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/7/gitlab-ce-12.8.7-ce.0.el7.x86_64.rpm" class="bare">https://packages.gitlab.com/gitlab/gitlab-ce/packages/el/7/gitlab-ce-12.8.7-ce.0.el7.x86_64.rpm</a></code></p>
</div>
<div class="paragraph">
<div class="title"><code>yum</code> 安装</div>
<p><code>yum localinstall gitlab-ce-12.8.7-ce.0.el7.x86_64.rpm</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_初始化">2.1.2. 初始化</h4>
<div class="paragraph">
<div class="title"><code>nginx</code> 端口冲突，关闭本地 <code>nginx</code> 服务</div>
<p><code>systemctl stop nginx</code><br>
<code>systemctl disable nginx</code></p>
</div>
<div class="paragraph">
<div class="title">初始化 <code>gitlab</code></div>
<p><code>gitlab-ctl reconfigure</code></p>
</div>
<div class="paragraph">
<div class="title">启动</div>
<p><code>gitlab-ctl start</code></p>
</div>
<div class="paragraph">
<div class="title">停止</div>
<p><code>gitlab-ctl stop</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_修改配置">2.1.3. 修改配置</h4>
<div class="paragraph">
<div class="title"><code>git</code> 克隆地址改为本机IP地址</div>
<p><code>sed -i '13s/    host: gitlab.example.com/    host: 192.168.2.7/' /opt/gitlab/embedded/service/gitlab-rails/config/gitlab.yml</code></p>
</div>
<div class="paragraph">
<div class="title">客户端访问</div>
<p><code>192.168.2.7</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>初始用户名：root<br>
密码自定义</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_用户设置">2.1.4. 用户设置</h4>
<div class="listingblock">
<div class="title">设置 <code>Access Tokens</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">用户 --&gt; settings --&gt; Access Tokens

填写名称:

勾选：api
      read_user

确定：Create personal access token

记录access token
PhY2RK4spkepP9g_3yf9</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">添加公钥</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">用户 --&gt; settings --&gt; SSH Keys

cd ~/.ssh/ 查看自己的公钥添加到gitlab,通常是以.pub结尾的文件
ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDKhTFrjT3qhHAKhQDaU1ZKkIYANiByqFYXA+3L+thfghkwt3+hrCNZ17LU+/vIl0lIn4pbgjtkYuI7wVVUW9Z7PeNRVMSy6Ql70RD6ZF9BdfCBnPoNs3Ad3S2IVQ3WkqIrXKfKDcypLibSECR8+7yQagnxAOXl2qjEeywv06M3Z2TUdUJ9VgSagZOvTvQB3h4SEuJ3RxinhkRNiuWwUcx3Q1t2Bf2VTvBkCfZHTADXc0+uKVwHGuTHZzP+Y1hK9Pqpb3pv4qUcq4Pu0dcLS8HElOe2xo8DXu7yXvDGOJrDbNQytk/+bzc3wmIGlkr8SKvuEVZ+nD32D2byCyNnP91d root@vir19

最后 Add key

服务器添加公钥之后在本机添加公钥钥匙
cat &lt;&lt; EOF &gt; ~/.ssh/config
Host 192.168.2.7
    IdentityFile ~/.ssh/mk
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建项目</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">Create new project --&gt; 填写项目名称 --&gt; Create project --&gt; clone</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">创建 <code>webhook</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">Projects --&gt; redas_lib --&gt; settings --&gt; Integrations
（Jenkins --&gt; 项目 --&gt; Build when a change is pushed to GitLab. GitLab webhook URL:）
url: http://192.168.2.19:8080/project/redas_lib
勾选：Push events
      Merge request events
确认添加</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">允许本地网络请求</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">Admin Area --&gt; settings --&gt; Network --&gt; Outbound requests --&gt; Expand
勾选：Allow requests to the local network from web hooks and services</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Jenkins_chapter">3. Jenkins</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>基于 CentOS 7</strong></p>
</div>
<div class="sect2">
<h3 id="_jenkins">3.1. Jenkins</h3>
<div class="sect3">
<h4 id="_下载安装_2">3.1.1. 下载安装</h4>
<div class="paragraph">
<div class="title">官方下载RPM包</div>
<p><code>wget <a href="https://pkg.jenkins.io/redhat-stable/jenkins-2.204.5-1.1.noarch.rpm" class="bare">https://pkg.jenkins.io/redhat-stable/jenkins-2.204.5-1.1.noarch.rpm</a></code></p>
</div>
<div class="paragraph">
<div class="title"><code>yum</code> 安装</div>
<p><code>yum localinstall jenkins-2.204.5-1.1.noarch.rpm</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_启动">3.1.2. 启动</h4>
<div class="paragraph">
<div class="title">检查 <code>java</code> 版本</div>
<p><code>java -version</code></p>
</div>
<div class="paragraph">
<div class="title">设置 <code>java</code> 版本为1.8</div>
<p><code>sudo update-alternatives --config java</code></p>
</div>
<div class="paragraph">
<div class="title"><code>java</code> 1.8安装</div>
<p><code>yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel java-1.8.0-openjdk-headless</code></p>
</div>
<div class="paragraph">
<div class="title">正常启动</div>
<p><code>java -jar /usr/lib/jenkins/jenkins.war</code></p>
</div>
<div class="paragraph">
<div class="title">代理方式启动</div>
<p><code>java -DsocksProxyHost=192.168.2.5 -DsocksProxyPort=1080 -jar jenkins.war</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>先用代理启动，Jenkins初始化需要安装许多外网插件，插件安装完后去掉代理，正常启动<br></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_初始化_2">3.1.3. 初始化</h4>
<div class="listingblock">
<div class="title">安装插件</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">gitlab
gitlab hook</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置 <code>SSH</code> 密钥</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">凭据 --&gt; 系统 --&gt; 全局凭据 --&gt;添加凭据

kind：SSH Username with private key
description:jenkins_ssh_key
Enter directly（勾选）
Private Key:(~/.ssh/目录查看自己的私钥，添加)

保存</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">配置 <code>API token</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">凭据 --&gt; 系统 --&gt; 全局凭据 --&gt;添加凭据

kind：Gitlab api token
API token: (gitlab服务器创建的API token)
描述：gitlab_api_token

确定</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">修改配置</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">系统管理 -&gt; 系统配置 -&gt;
Enable authentication for '/project' end-point  (web hook 403权限问题去掉打勾)
Gitlab
	Connection name	:gitlab7

 	Gitlab host URL	:http://192.168.2.7 (gitlab服务器地址)
 	Credentials	：API Token for accessing Gitlab （选配置好的API token）

    Test Connection(点击测试，返回Success为正确)
    Success</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Mysql_chapter">4. Mysql</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>基于 CentOS 7</strong></p>
</div>
<div class="sect2">
<h3 id="_web_备份迁移">4.1. <code>web</code> 备份迁移</h3>
<div class="sect3">
<h4 id="_mysql_备份还原">4.1.1. <code>mysql</code> 备份还原</h4>
<div class="paragraph">
<div class="title">备份</div>
<p><code>mysqldump -uroot -p&#8217;geek' --add-drop-table dedecms_foo_com &gt; /data/db/dedecms_foo_com.sql</code></p>
</div>
<div class="paragraph">
<div class="title">备份的每条数据增加 insert 语句</div>
<p><code>mysqldump -uroot -p&#8217;geek' --extended-insert=FALSE dedecms_foo_com&gt;dedecms_foo_com.sql</code></p>
</div>
<div class="paragraph">
<div class="title">还原</div>
<p><code>mysql -uroot -p&#8217;geek' dedecms_foo_com &lt; /data/db/dedecms_foo_com.sql</code></p>
</div>
<div class="paragraph">
<div class="title">打包压缩</div>
<p><code>tar -zcvf /data/db/dedecms_foo_com.sql.tar.gz -C /data/db/dedecms_foo_com.sql</code></p>
</div>
<div class="paragraph">
<div class="title">备份到服务器</div>
<p><code>rsync -a --log-file=/tmp/rsync.log /data/db/ root@192.168.2.8:/data/backup/db/</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_web_文件备份">4.1.2. <code>web</code> 文件备份</h4>
<div class="paragraph">
<div class="title">备份到服务器</div>
<p><code>rsync -a --log-file=/tmp/rsync.log /data/web/ root@192.168.2.8:/data/backup/web/</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_命令参数解释">4.1.3. 命令参数解释</h4>
<div class="sect4">
<h5 id="_mysqldump">mysqldump</h5>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>--add-drop-table</code></dt>
<dt class="hdlist1">解释</dt>
<dd>
<p>在每个创建数据库表语句前添加删除数据库表的语句</p>
</dd>
<dt class="hdlist1">例子</dt>
<dd>
<p><code>mysqldump -uroot -pgeek --add-drop-table db_name &gt; db_name.sql</code></p>
</dd>
<dt class="hdlist1"><code>--databases</code></dt>
<dt class="hdlist1">解释</dt>
<dd>
<p>导出指定的数据库</p>
</dd>
<dt class="hdlist1">例子</dt>
<dd>
<p><code>mysqldump -uroot -pgeek --databases foo bar &gt;foo_bar.sql</code></p>
</dd>
<dt class="hdlist1"><code>--no-data --databases</code></dt>
<dt class="hdlist1">解释</dt>
<dd>
<p>仅导出表结构</p>
</dd>
<dt class="hdlist1">例子</dt>
<dd>
<p><code>mysqldump -uroot -pgeek --no-data --databases db_name &gt;db_name.sql</code></p>
</dd>
<dt class="hdlist1"><code>-t</code></dt>
<dt class="hdlist1">解释</dt>
<dd>
<p>仅导出数据</p>
</dd>
<dt class="hdlist1">例子</dt>
<dd>
<p><code>mysqldump -uroot -pgeek -t foo &gt; foo.sql</code></p>
</dd>
<dt class="hdlist1"><code>--all-databases</code></dt>
<dt class="hdlist1">解释</dt>
<dd>
<p>导出所有数据库</p>
</dd>
<dt class="hdlist1">例子</dt>
<dd>
<p><code>mysqldump -uroot -pgeek --all-databases &gt;all_database.sql</code></p>
</dd>
<dt class="hdlist1"><code>--databases db --tables foo bar</code></dt>
<dt class="hdlist1">解释</dt>
<dd>
<p>导出指定表</p>
</dd>
<dt class="hdlist1">例子</dt>
<dd>
<p><code>mysqldump -uroot -pgeek --databases db_name --tables foo bar  &gt;db_name_foo_bar.sql</code></p>
</dd>
</dl>
</div>
</div>
<div class="sect4">
<h5 id="_mysql">mysql</h5>
<div class="paragraph">
<p>示例：<br>
<code>mysqldump -uroot -pgeek --add-drop-table db_name &gt; db_name.sql</code></p>
</div>
<div class="paragraph">
<p>参数解释：<br>
-h：mysql服务器的ip地址或主机名<br>
-u：连接mysql服务器的用户名<br>
-e：执行mysql内部命令<br>
-p：连接mysql服务器的密码<br>
-D：使用哪个数据库</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_tar">4.1.4. tar</h4>
<div class="paragraph">
<p>示例：<br>
打包<br>
<code>tar -zcvf test.tar.gz -C /root/document/test</code><br>
列出文档<br>
<code>tar -tf test.tar</code><br>
提取文档<br>
<code>tar -xf test.tar</code><br>
参数解释：<br>
-c：创建归档<br>
-f：指定归档文件<br>
-v：显示指令执行过程<br>
-z：通过gzip指令压缩/解压缩文件，文件名最好为*.tar.gz<br>
-C：改变工作目录<br>
-t：列出归档文件的内容<br>
-x：从归档文件中提取文件</p>
</div>
</div>
<div class="sect3">
<h4 id="_rsync">4.1.5. rsync</h4>
<div class="paragraph">
<p>示例：<br>
<code>rsync -a --log-file=/tmp/rsync.log --backup-dir=data/web/change/ /data/web/ /root/backup/web/</code><br>
-a：归档模式，表示以递归方式传输文件，并保持所有文件属性<br>
--backup-dir=： 将备份文件存放在=后的目录下<br>
--log-file=/tmp/rsync.log ：设置日志文件</p>
</div>
<div class="paragraph">
<p><code>rsync -v --delete /test1/ /test/</code><br>
--delete：删除目标目录中不相同的文件<br>
-v：详细模式输出</p>
</div>
<div class="paragraph">
<p><code>rsync -avzP -e 'ssh -p 22' /tmp/ root@192.168.87.133:/tmp</code><br></p>
</div>
<div class="paragraph">
<p><code>rsync -avzP -e 'ssh -p 22' root@192.168.87.133:/tmp/ /tmp</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_crontab">4.1.6. crontab</h4>
<div class="paragraph">
<p><code>crontab</code> 命令被用来提交和管理用户的需要周期性执行的任务</p>
</div>
<div class="paragraph">
<p>示例：<br></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">[root@cky ~]# crontab  -l
*/1 * * * * /bin/sh /usr/bin/vnstat_dump.sh
#1 2 * * * /bin/sh /bak/local_bak/script/tar_mysql_bin.sh
1 3 * * * /bin/sh /bak/local_bak/script/rsync_from_local.sh
1 4 * * * /bin/sh /bak/local_bak/script/full_db_bak.sh

#*/1 * * * * /bin/sh /bak/script/kill_query_timeout.sh
#*/10 * * * * /etc/init.d/php-fpm_www  restart

1 */1 * * * /bin/sh /opt/git_pull_new_ck.sh
59 23 * * 0,6 /bin/sh /bak/script/renew.sh</code></pre>
</div>
</div>
<div class="paragraph">
<p>参数解释：<br>
-e：编辑该用户的计时器设置<br>
-l：列出该用户的计时器设置</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>crontab文件的含义：用户所建立的crontab文件中，每一行都代表一项任务，每行的每个字段代表一项设置，它的格式共分为六个字段，前五段是时间设定段，第六段是要执行的命令段，格式如下：</p>
</div>
<div class="paragraph">
<p>minute   hour   day   month   week   command  顺序：分 时 日 月 周 命令段</p>
</div>
<div class="paragraph">
<p>minute： 表示分钟，可以是从0到59之间的任何整数</p>
</div>
<div class="paragraph">
<p>hour：表示小时，可以是从0到23之间的任何整数</p>
</div>
<div class="paragraph">
<p>day：表示日期，可以是从1到31之间的任何整数</p>
</div>
<div class="paragraph">
<p>month：表示月份，可以是从1到12之间的任何整数</p>
</div>
<div class="paragraph">
<p>week：表示星期几，可以是从0到7之间的任何整数，这里的0或7代表星期日</p>
</div>
<div class="paragraph">
<p>command：要执行的命令，可以是系统命令，也可以是自己编写的脚本文件</p>
</div>
<div class="paragraph">
<p>在以上各个字段中，还可以使用以下特殊字符：</p>
</div>
<div class="paragraph">
<p>*：代表所有可能的值，例如month字段如果是星号，则表示在满足其它字段的制约条件后每月都执行该命令操作</p>
</div>
<div class="paragraph">
<p>, ：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”</p>
</div>
<div class="paragraph">
<p>-：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”</p>
</div>
<div class="paragraph">
<p>/ ：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。同时正斜线可以和星号一起使用，例如*/10，如果用在minute字段，表示每十分钟执行一次</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mysql_主从">4.2. <code>Mysql</code> 主从</h3>
<div class="paragraph">
<p>mysql  Ver 8.0.19 for Linux on x86_64 (MySQL Community Server - GPL)</p>
</div>
<div class="paragraph">
<p>master 地址：192.168.43.3
slave 地址：192.168.43.114</p>
</div>
<div class="sect3">
<h4 id="_gtid主从配置">4.2.1. GTID主从配置</h4>
<div class="listingblock">
<div class="title">配置master</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">vim /etc/my.cnf
    [mysqld]
    default-authentication-plugin=mysql_native_password
    datadir=/var/lib/mysql
    socket=/var/lib/mysql/mysql.sock
    log-error=/var/log/mysqld.log
    pid-file=/var/run/mysqld/mysqld.pid
    user=mysql
    port=3306
    server-id=1
    gtid-mode=ON
    enforce-gtid-consistency=ON
    binlog_format=row</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">重启 <code>mysql</code> 服务，关闭防火墙</div>
<p><code>systemctl restart mysqld</code><br>
<code>systemctl  stop  firewalld</code><br>
<code>systemctl mask firewalld.service</code></p>
</div>
<div class="listingblock">
<div class="title">配置slave</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">vim /etc/my.cnf
[mysqld]
    default-authentication-plugin=mysql_native_password
    datadir=/var/lib/mysql
    socket=/var/lib/mysql/mysql.sock
    log-error=/var/log/mysqld.log
    pid-file=/var/run/mysqld/mysqld.pid
    user=mysql
    port=3306
    server-id=2
    gtid-mode=ON
    enforce-gtid-consistency=ON
    binlog_format=row</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">重启 <code>mysql</code> 服务，关闭防火墙</div>
<p><code>systemctl restart mysqld</code><br>
<code>systemctl  stop  firewalld</code><br>
<code>systemctl mask firewalld.service</code></p>
</div>
<div class="paragraph">
<div class="title">master创建用户授权</div>
<p><code>mysql -uroot -pgeek</code><br>
<code>set global validate_password_policy=0;</code><br>
<code>set global validate_password_length=1;</code><br>
<code>flush privileges;</code><br>
<code>CREATE USER 'slave123'@'%' IDENTIFIED BY 'geek';</code><br>
<code>GRANT REPLICATION SLAVE ON <strong>.</strong> TO 'slave123'@'%';</code><br>
<code>flush privileges;</code></p>
</div>
<div class="paragraph">
<div class="title">查看master状态</div>
<p><code>show master status;</code></p>
</div>
<div class="paragraph">
<div class="title">slave同步设置</div>
<p><code>mysql -uroot -pgeek</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="mysql" class="language-mysql hljs">CREATE USER 'slave123'@'%' IDENTIFIED BY 'geek';
GRANT REPLICATION SLAVE ON *.* TO 'slave123'@'%';
flush privileges;
stop slave;
change master to master_host='192.168.2.17', master_user='slave123',master_password='geek',master_port=3306,master_auto_position=1;
start slave;

#查看slave状态
show slave status\G</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">mysql8卸载安全策略</div>
<p><code>UNINSTALL COMPONENT 'file://component_validate_password';</code></p>
</div>
<div class="listingblock">
<div class="title">验证主从</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">master:
    create database test1;
    show master status;

slave:
    show databases;
    show slave status\G
*************************** 1. row ***************************
               Slave_IO_State: Waiting for master to send event
                  Master_Host: 192.168.43.3
                  Master_User: slave123
                  Master_Port: 3306
                Connect_Retry: 60
              Master_Log_File: binlog.000035
          Read_Master_Log_Pos: 1687
               Relay_Log_File: dbslave-relay-bin.000005
                Relay_Log_Pos: 1895
        Relay_Master_Log_File: binlog.000035
             Slave_IO_Running: Yes
            Slave_SQL_Running: Yes
                Last_IO_Errno: 0
                Last_IO_Error:
               Last_SQL_Errno: 0
               Last_SQL_Error:
  Replicate_Ignore_Server_Ids:
             Master_Server_Id: 1
                  Master_UUID: 76475db1-5150-11ea-8853-0800275e2671
             Master_Info_File: mysql.slave_master_info
                    SQL_Delay: 0
          SQL_Remaining_Delay: NULL
      Slave_SQL_Running_State: Slave has read all relay log; waiting for more updates
           Master_Retry_Count: 86400
           Master_SSL_Crlpath:
           Retrieved_Gtid_Set: 76475db1-5150-11ea-8853-0800275e2671:88-99
            Executed_Gtid_Set: 76475db1-5150-11ea-8853-0800275e2671:1-99,
93a238d7-5150-11ea-9fb7-080027da57dd:1-66</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_mycat">4.3. Mycat</h3>
<div class="sect3">
<h4 id="_安装_mycat">4.3.1. 安装 <code>mycat</code></h4>
<div class="paragraph">
<div class="title"><code>install</code></div>
<p><code>wget -c wget -c <a href="http://dl.mycat.io/1.6.7.3/Mycat-server-1.6.7.3-release-20190828135747-linux.tar.gz" class="bare">http://dl.mycat.io/1.6.7.3/Mycat-server-1.6.7.3-release-20190828135747-linux.tar.gz</a></code><br>
<code>tar xf Mycat-server-1.6.7.3-release-20190828135747-linux.tar.gz</code><br>
<code>mv mycat /usr/local/</code><br>
<code>rm -rf mycat</code></p>
</div>
<div class="paragraph">
<div class="title">安装 <code>java</code> 1.8</div>
<p><code>yum install -y java-1.8.0-openjdk java-1.8.0-openjdk-devel java-1.8.0-openjdk-headless</code></p>
</div>
<div class="paragraph">
<div class="title">修改配置文件</div>
<p><code>vim /usr/local/mycat/conf/schema.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">&lt;?xml version="1.0"?&gt;
&lt;!DOCTYPE mycat:schema SYSTEM "schema.dtd"&gt;
&lt;mycat:schema xmlns:mycat="http://io.mycat/"&gt;

    &lt;schema name="db1" checkSQLschema="true" sqlMaxLimit="1000" dataNode="data_node1" /&gt;

    &lt;dataNode name="data_node1" dataHost="db_host1" database="db1"/&gt;

    &lt;dataHost name="db_host1" maxCon="1000" minCon="10" balance="1"
              writeType="0" dbType="mysql" dbDriver="native" switchType="-1" slaveThreshold="100"&gt;

        &lt;heartbeat&gt;select user()&lt;/heartbeat&gt;

        &lt;writeHost host="host_write" url="192.168.43.3:3306" user="slave123" password="geek"&gt;
            &lt;readHost host="host_read" url="192.168.43.114:3306" user="slave123" password="geek"/&gt;
        &lt;/writeHost&gt;

    &lt;/dataHost&gt;
&lt;/mycat:schema&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>vim /usr/local/mycat/conf/server.xml</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!DOCTYPE mycat:server SYSTEM "server.dtd"&gt;
&lt;mycat:server xmlns:mycat="http://io.mycat/"&gt;

        &lt;system&gt;
                &lt;property name="bindIp"&gt;0.0.0.0&lt;/property&gt;
        &lt;/system&gt;

        &lt;firewall&gt;
           &lt;whitehost&gt;
              &lt;host host="127.0.0.1" user="slave123"/&gt;
              &lt;host host="192.168.43.*" user="slave123"/&gt;
           &lt;/whitehost&gt;
           &lt;blacklist check="false"&gt;
           &lt;/blacklist&gt;
       &lt;/firewall&gt;

        &lt;user name="slave123" defaultAccount="true"&gt;
                &lt;property name="password"&gt;geek&lt;/property&gt;
                &lt;property name="schemas"&gt;db1&lt;/property&gt;
        &lt;/user&gt;
&lt;/mycat:server&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">必须将主机名加入HOSTS文件</div>
<p><code>echo "127.0.0.1 dbmaster" &gt;&gt; /etc/hosts</code></p>
</div>
<div class="paragraph">
<div class="title"><code>mycat</code> 启动</div>
<p><code>/usr/local/mycat/bin/mycat start</code></p>
</div>
<div class="paragraph">
<div class="title">重启</div>
<p><code>/usr/local/mycat/bin/mycat restart</code></p>
</div>
<div class="paragraph">
<div class="title">停止</div>
<p><code>/usr/local/mycat/bin/mycat stop</code></p>
</div>
<div class="paragraph">
<div class="title">查看状态</div>
<p><code>/usr/local/mycat/bin/mycat status</code></p>
</div>
<div class="paragraph">
<div class="title">连接数据库</div>
<p><code>mysql -h127.0.0.1 -P9066 -uslave123 -pgeek  db1</code></p>
</div>
<div class="paragraph">
<div class="title">查看读写分离</div>
<p>show @@datasource;</p>
</div>
<div class="paragraph">
<div class="title">检测心跳线</div>
<p>show @@heartbeat;</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Centos_chapter">5. Centos</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_centos7初始化">5.1. Centos7初始化</h3>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">#查看主机名
hostnamectl status

#修改主机名
hostnamectl set-hostname 主机名

#禁用SELINUX，必须重启才能生效
echo SELINUX=disabled&gt;/etc/selinux/config
echo SELINUXTYPE=targeted&gt;&gt;/etc/selinux/config

#临时关闭，不需要重启
setenforce 0

#如果你想使用自己的 iptables 静态防火墙规则, 那么请安装 iptables-services 并且禁用 firewalld ，启用 iptables
systemctl  stop  firewalld
systemctl mask firewalld.service


systemctl mask NetworkManager

#最大可以打开的文件
echo "*               soft   nofile            65535" &gt;&gt; /etc/security/limits.conf
echo "*               hard   nofile            65535" &gt;&gt; /etc/security/limits.conf

# ssh登录时，登录ip被会反向解析为域名，导致ssh登录缓慢
sed -i "s/#UseDNS yes/UseDNS no/" /etc/ssh/sshd_config
sed -i "s/GSSAPIAuthentication yes/GSSAPIAuthentication no/" /etc/ssh/sshd_config
sed -i "s/GSSAPICleanupCredentials yes/GSSAPICleanupCredentials no/" /etc/ssh/sshd_config
sed -i "s/#MaxAuthTries 6/MaxAuthTries 10/" /etc/ssh/sshd_config
# server每隔30秒发送一次请求给client，然后client响应，从而保持连接
sed -i "s/#ClientAliveInterval 0/ClientAliveInterval 30/" /etc/ssh/sshd_config
# server发出请求后，客户端没有响应得次数达到3，就自动断开连接，正常情况下，client不会不响应
sed -i "s/#ClientAliveCountMax 3/ClientAliveCountMax 10/" /etc/ssh/sshd_config

#支持gbk文件显示
echo "set fencs=utf-8,gbk" &gt;&gt; /etc/vimrc

#设定系统时区
yes|cp /usr/share/zoneinfo/Asia/Chongqing /etc/localtime

#如果是x86_64系统，排除32位包
echo "exclude=*.i386 *.i586 *.i686" &gt;&gt; /etc/yum.conf</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">查看当前开了哪些端口</div>
<p><code>firewall-cmd --list-services</code></p>
</div>
<div class="paragraph">
<div class="title">查看还有哪些服务可以打开</div>
<p><code>firewall-cmd --get-services</code></p>
</div>
<div class="paragraph">
<div class="title">添加一个服务到firewalld</div>
<p><code>firewall-cmd --add-service=http</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_centos7_install_lnmp">5.2. CentOS7 Install LNMP</h3>
<div class="sect3">
<h4 id="_安装_nginx">5.2.1. 安装 Nginx</h4>
<div class="listingblock">
<div class="title">增加 Nginx 官方源</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /etc/yum.repos.d/nginx.repo
[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/\$releasever/\$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/\$releasever/\$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
EOF</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>EPEL 源中的 <code>nginx.service</code> 由于 <code>KILL</code> 参数问题，启动后无法停止，不建议使用。</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">安装Nginx</div>
<p><code>yum install -y nginx</code></p>
</div>
<div class="paragraph">
<div class="title">备份Nginx配置文件</div>
<p><code>echo y|cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.default</code></p>
</div>
<div class="listingblock">
<div class="title">修改 nginx.conf</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /etc/nginx/nginx.conf
# For more information on configuration, see:
#   * Official English Documentation: http://nginx.org/en/docs/
#   * Official Russian Documentation: http://nginx.org/ru/docs/

user nginx;
worker_processes auto;
error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;

worker_rlimit_nofile 65535;

events {
    worker_connections 65535;
}

http {
    include             /etc/nginx/mime.types;
    default_type        application/octet-stream;

    log_format  main  '\$host \$server_port \$remote_addr - \$remote_user [\$time_local] "\$request" '
                      '\$status \$request_time \$body_bytes_sent "\$http_referer" '
                      '"\$http_user_agent" "\$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile            on;
    tcp_nopush          on;
    tcp_nodelay         on;
    keepalive_timeout   65;
    types_hash_max_size 2048;

    server_names_hash_bucket_size 128;
    server_name_in_redirect off;
    client_header_buffer_size 32k;
    large_client_header_buffers 4 32k;

    client_header_timeout  3m;
    client_body_timeout    3m;
    client_max_body_size 50m;
    client_body_buffer_size 256k;
    send_timeout           3m;

    gzip  on;
    gzip_min_length  1k;
    gzip_buffers     4 16k;
    gzip_http_version 1.0;
    gzip_comp_level 2;
    gzip_types text/plain application/x-javascript text/css application/xml;
    gzip_vary on;

    proxy_redirect off;
    proxy_set_header Host \$host;
    proxy_set_header X-Real-IP \$remote_addr;
    proxy_set_header REMOTE-HOST \$remote_addr;
    proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
    proxy_connect_timeout 60;
    proxy_send_timeout 60;
    proxy_read_timeout 60;
    proxy_buffer_size 256k;
    proxy_buffers 4 256k;
    proxy_busy_buffers_size 256k;
    proxy_temp_file_write_size 256k;
    proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;
    proxy_max_temp_file_size 128m;
    #让代理服务端不要主动关闭客户端的连接，协助处理499返回代码问题
    proxy_ignore_client_abort on;

    fastcgi_buffer_size 64k;
    fastcgi_buffers 4 64k;
    fastcgi_busy_buffers_size 128k;

    index index.html index.htm index.php default.html default.htm default.php;

    # Load modular configuration files from the /etc/nginx/conf.d directory.
    # See http://nginx.org/en/docs/ngx_core_module.html#include
    # for more information.
    include /etc/nginx/conf.d/*.conf;
}
EOF</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">增加默认Host</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">mkdir /etc/nginx/conf.d

cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/default.conf
server {
    listen       80 default_server;
    listen       [::]:80 default_server;
    server_name  _;
    root         /usr/share/nginx/html;

    # Load configuration files for the default server block.
    include /etc/nginx/default.d/*.conf;

    location / {
    }

    error_page 404 /404.html;
        location = /40x.html {
    }

    error_page 500 502 503 504 /50x.html;
        location = /50x.html {
    }
}
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">检测配置</div>
<p><code>nginx -t &amp;&amp; rm -f /var/run/nginx.pid</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>nginx -t</code> 之后，<code>/var/run/nginx.pid</code> 空文件会一直被保留，而 <code>nginx.service</code> 并不能处理 <code>PIDFile</code> 为空的情况，导致启动失败。</p>
</div>
<div class="paragraph">
<p>需要手动删除 <code>/var/run/nginx.pid</code></p>
</div>
<div class="paragraph">
<p>from nginx/1.16.1</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">启动Nginx</div>
<p><code>systemctl start nginx</code></p>
</div>
<div class="listingblock">
<div class="title">查看Nginx状态</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs"># systemctl status nginx
● nginx.service - The nginx HTTP and reverse proxy server
   Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)
   Active: active (running) since Fri 2019-11-29 14:02:31 CST; 1h 18min ago
 Main PID: 15759 (nginx)
   CGroup: /system.slice/nginx.service
           ├─15759 nginx: master process /usr/sbin/nginx
           └─17285 nginx: worker process

Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ systemd[1]: Starting The nginx HTTP and reverse proxy server...
Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ nginx[15753]: nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ nginx[15753]: nginx: configuration file /etc/nginx/nginx.conf test is successful
Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ systemd[1]: Failed to parse PID from file /run/nginx.pid: Invalid argument
Nov 29 14:02:31 iZ6weebcmroarpx8rrxscrZ systemd[1]: Started The nginx HTTP and reverse proxy server.


# ss -antpl|grep nginx
LISTEN     0      128          *:80                       *:*                   users:(("nginx",pid=17285,fd=6),("nginx",pid=15759,fd=6))
LISTEN     0      128         :::80                      :::*                   users:(("nginx",pid=17285,fd=7),("nginx",pid=15759,fd=7))</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">增加开机启动</div>
<p><code>systemctl enable nginx</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_安装_mysql">5.2.2. 安装 MySQL</h4>
<div class="paragraph">
<div class="title">安装 MySQL</div>
<p><code>yum install -y mariadb-server</code></p>
</div>
<div class="paragraph">
<div class="title">备份 <code>my.cnf</code></div>
<p><code>cp /etc/my.cnf /etc/my.cnf.default</code></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>my.cnf</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /etc/my.cnf
[mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0
# Settings user and group are ignored when systemd is used.
# If you need to run mysqld under a different user or group,
# customize your systemd unit file for mariadb according to the
# instructions in http://fedoraproject.org/wiki/Systemd

max_allowed_packet=20M
max_heap_table_size = 100M
read_buffer_size = 2M
read_rnd_buffer_size = 16M
sort_buffer_size = 8M
join_buffer_size = 8M
tmp_table_size = 100M

# 查询缓存
#query_cache_limit=4M
#query_cache_type=on
#query_cache_size=2G

bind-address = 127.0.0.1
# 跳过主机名解析，比如localhost，foo.com之类，加速访问
skip-name-resolve

# SQL执行日志
general_log=off
general_log_file=/var/log/mariadb/general.log

# SQL慢查询日志
slow_query_log=off
slow_query_log_file=/var/log/mariadb/slowquery.log
long_query_time = 5

max_connections = 1000

# 兼容老MySQL代码，比如使用空字符串代替NULL插入数据
sql_mode = ""

[mysqld_safe]
log-error=/var/log/mariadb/mariadb.log
pid-file=/var/run/mariadb/mariadb.pid

#
# include all files from the config directory
#
!includedir /etc/my.cnf.d
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">配置 <code>mysqldump</code> 命令参数</div>
<p><code>sed -i '16 aquick\nquote-names\nmax_allowed_packet = 100M' /etc/my.cnf.d/mysql-clients.cnf</code></p>
</div>
<div class="listingblock">
<div class="title">创建日志文件</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">touch /var/log/mariadb/general.log /var/log/mariadb/slowquery.log
chown mysql:mysql /var/log/mariadb/general.log /var/log/mariadb/slowquery.log</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">增加开机启动</div>
<p><code>systemctl enable mariadb</code></p>
</div>
<div class="paragraph">
<div class="title">启动 <code>MySQL</code> 服务</div>
<p><code>systemctl start mariadb</code></p>
</div>
<div class="listingblock">
<div class="title">查看 <code>MySQL</code> 服务状态</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs"># systemctl status mariadb
● mariadb.service - MariaDB database server
   Loaded: loaded (/usr/lib/systemd/system/mariadb.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2019-11-29 14:18:12 CST; 1h 7min ago
  Process: 16688 ExecStartPost=/usr/libexec/mariadb-wait-ready $MAINPID (code=exited, status=0/SUCCESS)
  Process: 16653 ExecStartPre=/usr/libexec/mariadb-prepare-db-dir %n (code=exited, status=0/SUCCESS)
 Main PID: 16687 (mysqld_safe)
   CGroup: /system.slice/mariadb.service
           ├─16687 /bin/sh /usr/bin/mysqld_safe --basedir=/usr
           └─17043 /usr/libexec/mysqld --basedir=/usr --datadir=/var/lib/mysql --plugin-dir=/usr/lib64/mysql/plugin --log-error=/var/log/mariadb/mariadb.lo...

Nov 29 14:18:10 iZ6weebcmroarpx8rrxscrZ systemd[1]: Starting MariaDB database server...
Nov 29 14:18:10 iZ6weebcmroarpx8rrxscrZ mariadb-prepare-db-dir[16653]: Database MariaDB is probably initialized in /var/lib/mysql already, nothing is done.
Nov 29 14:18:11 iZ6weebcmroarpx8rrxscrZ mysqld_safe[16687]: 191129 14:18:11 mysqld_safe Logging to '/var/log/mariadb/mariadb.log'.
Nov 29 14:18:11 iZ6weebcmroarpx8rrxscrZ mysqld_safe[16687]: 191129 14:18:11 mysqld_safe Starting mysqld daemon with databases from /var/lib/mysql
Nov 29 14:18:12 iZ6weebcmroarpx8rrxscrZ systemd[1]: Started MariaDB database server.

# ss -antpl|grep mysql
LISTEN     0      50     127.0.0.1:3306                     *:*                   users:(("mysqld",pid=17043,fd=14))</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">修改root密码</div>
<p><code>mysqladmin -uroot password "geek"</code></p>
</div>
<div class="listingblock">
<div class="title">删除测试数据库和空密码用户</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">mysql -uroot -pgeek -e 'show databases;'
mysql -uroot -pgeek -e 'drop database test;'
mysql -uroot -pgeek mysql -e 'delete from db;'
mysql -uroot -pgeek mysql -e 'delete from user where Password="";'
mysql -uroot -pgeek -e 'flush privileges;'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_安装_php7">5.2.3. 安装 PHP7</h4>
<div class="paragraph">
<div class="title">增加SCL源</div>
<p><code>yum install -y centos-release-scl</code></p>
</div>
<div class="listingblock">
<div class="title">安装PHP7.2</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">yum install -y rh-php72 \
    rh-php72-php  \
    rh-php72-php-bcmath \
    rh-php72-php-fpm \
    rh-php72-php-gd \
    rh-php72-php-intl \
    rh-php72-php-mbstring \
    rh-php72-php-mysqlnd \
    rh-php72-php-opcache \
    rh-php72-php-pdo \
    rh-php72-php-pecl-apcu \
    rh-php72-php-xmlrpc \
    rh-php72-php-devel</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">进入 <code>rh-php72</code> 环境</div>
<p><code>scl enable rh-php72 bash</code></p>
</div>
<div class="listingblock">
<div class="title">确认PHP状态</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs"># php -v
PHP 7.2.24 (cli) (built: Nov  4 2019 10:23:08) ( NTS )
Copyright (c) 1997-2018 The PHP Group
Zend Engine v3.2.0, Copyright (c) 1998-2018 Zend Technologies
    with Zend OPcache v7.2.24, Copyright (c) 1999-2018, by Zend Technologies</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">备份php.ini</div>
<p><code>cp /etc/opt/rh/rh-php72/php.ini /etc/opt/rh/rh-php72/php.ini.default</code></p>
</div>
<div class="listingblock">
<div class="title">修改php.ini</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs"># 启用 '&lt;? ... ?&gt;' 代码风格
sed -i '197s/short_open_tag = Off/short_open_tag = On/' /etc/opt/rh/rh-php72/php.ini

# 禁止一些危险性高的函数
sed -i '314s/disable_functions =/disable_functions = system,exec,shell_exec,passthru,set_time_limit,ini_alter,dl,openlog,syslog,readlink,symlink,link,leak,popen,escapeshellcmd,virtual,socket_create,mail,eval/' /etc/opt/rh/rh-php72/php.ini

# 配置中国时区
sed -i '902s#;date.timezone =#date.timezone = Asia/Shanghai#' /etc/opt/rh/rh-php72/php.ini</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">增加开机启动</div>
<p><code>systemctl enable rh-php72-php-fpm</code></p>
</div>
<div class="paragraph">
<div class="title">启动 <code>PHP-FPM</code> 服务</div>
<p><code>systemctl start rh-php72-php-fpm</code></p>
</div>
<div class="listingblock">
<div class="title">查看 <code>PHP-FPM</code> 服务状态</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs"># systemctl status rh-php72-php-fpm
● rh-php72-php-fpm.service - The PHP FastCGI Process Manager
   Loaded: loaded (/usr/lib/systemd/system/rh-php72-php-fpm.service; enabled; vendor preset: disabled)
   Active: active (running) since Fri 2019-11-29 13:36:03 CST; 1h 56min ago
 Main PID: 15360 (php-fpm)
   Status: "Processes active: 0, idle: 6, Requests: 56, slow: 0, Traffic: 0req/sec"
   CGroup: /system.slice/rh-php72-php-fpm.service
           ├─15360 php-fpm: master process (/etc/opt/rh/rh-php72/php-fpm.conf)
           ├─15361 php-fpm: pool www
           ├─15362 php-fpm: pool www
           ├─15363 php-fpm: pool www
           ├─15364 php-fpm: pool www
           ├─15365 php-fpm: pool www
           └─17211 php-fpm: pool www

Nov 29 13:36:03 iZ6weebcmroarpx8rrxscrZ systemd[1]: Starting The PHP FastCGI Process Manager...
Nov 29 13:36:03 iZ6weebcmroarpx8rrxscrZ systemd[1]: Started The PHP FastCGI Process Manager.

# ss -antpl|grep php-fpm
LISTEN     0      128    127.0.0.1:9000                     *:*                   users:(("php-fpm",pid=17211,fd=9),("php-fpm",pid=15365,fd=9),("php-fpm",pid=15364,fd=9),("php-fpm",pid=15363,fd=9),("php-fpm",pid=15362,fd=9),("php-fpm",pid=15361,fd=9),("php-fpm",pid=15360,fd=7))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_lnmp_环境测试">5.2.4. LNMP 环境测试</h4>
<div class="paragraph">
<div class="title">增加数据库</div>
<p><code>mysql -uroot -pgeek -e 'create database drupal;grant all privileges on drupal.*  to drupal@"localhost" identified by "drupal_password";flush privileges;'</code></p>
</div>
<div class="listingblock">
<div class="title">增加Nginx Host设置</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/drupal.foo.com.conf
server {
    listen       80;

    server_name  drupal.foo.com;
    root         /data/web/drupal.foo.com;
    error_log /var/log/nginx/drupal.foo.com_error.log;
    access_log /var/log/nginx/drupal.foo.com_access.log  main;

    location / {
        try_files \$uri /index.php\$is_args\$query_string;
    }

    location ~ \.php\$ {
        try_files \$uri \$uri/ 404;

        fastcgi_pass 127.0.0.1:9000;
        include fastcgi.conf;
    }
}
EOF

# 重载Nginx配置
nginx -t &amp;&amp; nginx -s reload</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">准备 <code>Drupal</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">mkdir -p /data/web/drupal.foo.com

# 使用 -O 参数指定保存文件名，会强制覆盖已经存在的文件
wget https://ftp.drupal.org/files/projects/drupal-8.7.10.tar.gz -O drupal-8.7.10.tar.gz
tar xf drupal-8.7.10.tar.gz

mv drupal-8.7.10/* /data/web/drupal.foo.com
rm -rf drupal-8.7.10
chown -R apache:nginx /data/web/drupal.foo.com
chmod -R 755 /data/web/drupal.foo.com</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>drupal-8.7.10/core/INSTALL.txt</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Drupal requires:</pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>A web server with PHP support, for example:</p>
</li>
<li>
<p>Apache 2.0 (or greater) (<a href="http://httpd.apache.org/" class="bare">http://httpd.apache.org/</a>).</p>
</li>
<li>
<p>Nginx 1.1 (or greater) (<a href="http://nginx.com/" class="bare">http://nginx.com/</a>).</p>
</li>
<li>
<p>PHP 5.5.9 (or greater) (<a href="http://php.net/" class="bare">http://php.net/</a>). For better security support it is
recommended to update to at least 5.5.21 or 5.6.5.</p>
</li>
<li>
<p>One of the following databases:</p>
</li>
<li>
<p>MySQL 5.5.3 (or greater) (<a href="http://www.mysql.com/" class="bare">http://www.mysql.com/</a>).</p>
</li>
<li>
<p>MariaDB 5.5.20 (or greater) (<a href="https://mariadb.org/" class="bare">https://mariadb.org/</a>). MariaDB is a fully
compatible drop-in replacement for MySQL.</p>
</li>
<li>
<p>Percona Server 5.5.8 (or greater) (<a href="http://www.percona.com/" class="bare">http://www.percona.com/</a>). Percona
Server is a backwards-compatible replacement for MySQL.</p>
</li>
<li>
<p>PostgreSQL 9.1.2 (or greater) (<a href="http://www.postgresql.org/" class="bare">http://www.postgresql.org/</a>).</p>
</li>
<li>
<p>SQLite 3.7.11 (or greater) (<a href="http://www.sqlite.org/" class="bare">http://www.sqlite.org/</a>).</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<div class="title">设置本地解析</div>
<p><code>echo '47.74.60.161 drupal.foo.com' &gt;&gt; /etc/hosts</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p><code>/etc/hosts</code> (Linux)</p>
</li>
<li>
<p><code>C:\Windows\System32\drivers\etc\hosts</code>（Windows）</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>最后，访问 <a href="http://drupal.foo.com" class="bare">http://drupal.foo.com</a> 完成安装。</p>
</div>
<div class="paragraph">
<p>Drupal数据库相关信息：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>数据库服务器：localhost</p>
</li>
<li>
<p>数据库端口：3306</p>
</li>
<li>
<p>数据库名称：drupal</p>
</li>
<li>
<p>数据库用户名：drupal</p>
</li>
<li>
<p>数据库密码：drupal_password</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_centos8lnmp">5.3. Centos8LNMP</h3>
<div class="sect3">
<h4 id="_安装nginx">5.3.1. 安装Nginx</h4>
<div class="paragraph">
<div class="title">增加EPEL源</div>
<p><code>dnf install -y epel-release</code></p>
</div>
<div class="paragraph">
<div class="title">备份Nginx配置文件</div>
<p><code>echo y|cp /etc/nginx/nginx.conf /etc/nginx/nginx.conf.defaultv</code></p>
</div>
<div class="listingblock">
<div class="title">修改 <code>nginx.conf</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /etc/nginx/nginx.conf
	# For more information on configuration, see:
	#   * Official English Documentation: http://nginx.org/en/docs/
	#   * Official Russian Documentation: http://nginx.org/ru/docs/

	user nginx;
	worker_processes auto;
	error_log /var/log/nginx/error.log;
	pid /run/nginx.pid;

	# Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.
	include /usr/share/nginx/modules/*.conf;

	worker_rlimit_nofile 65535;

	events {
		worker_connections 65535;
	}

	http {
		include             /etc/nginx/mime.types;
		default_type        application/octet-stream;

		log_format  main  '\$host \$server_port \$remote_addr - \$remote_user [\$time_local] "\$request" '
						  '\$status \$request_time \$body_bytes_sent "\$http_referer" '
						  '"\$http_user_agent" "\$http_x_forwarded_for"';

		access_log  /var/log/nginx/access.log  main;

		sendfile            on;
		tcp_nopush          on;
		tcp_nodelay         on;
		keepalive_timeout   65;
		types_hash_max_size 2048;

		server_names_hash_bucket_size 128;
		server_name_in_redirect off;
		client_header_buffer_size 32k;
		large_client_header_buffers 4 32k;

		client_header_timeout  3m;
		client_body_timeout    3m;
		client_max_body_size 50m;
		client_body_buffer_size 256k;
		send_timeout           3m;

		gzip  on;
		gzip_min_length  1k;
		gzip_buffers     4 16k;
		gzip_http_version 1.0;
		gzip_comp_level 2;
		gzip_types text/plain application/x-javascript text/css application/xml;
		gzip_vary on;

		proxy_redirect off;
		proxy_set_header Host \$host;
		proxy_set_header X-Real-IP \$remote_addr;
		proxy_set_header REMOTE-HOST \$remote_addr;
		proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
		proxy_connect_timeout 60;
		proxy_send_timeout 60;
		proxy_read_timeout 60;
		proxy_buffer_size 256k;
		proxy_buffers 4 256k;
		proxy_busy_buffers_size 256k;
		proxy_temp_file_write_size 256k;
		proxy_next_upstream error timeout invalid_header http_500 http_503 http_404;
		proxy_max_temp_file_size 128m;
		#让代理服务端不要主动关闭客户端的连接，协助处理499返回代码问题
		proxy_ignore_client_abort on;

		fastcgi_buffer_size 64k;
		fastcgi_buffers 4 64k;
		fastcgi_busy_buffers_size 128k;

		index index.html index.htm index.php default.html default.htm default.php;

		# Load modular configuration files from the /etc/nginx/conf.d directory.
		# See http://nginx.org/en/docs/ngx_core_module.html#include
		# for more information.
		include /etc/nginx/conf.d/*.conf;
	}
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">增加默认Host</div>
<p><code>mkdir /etc/nginx/conf.d</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/default.conf
	server {
		listen       80 default_server;
		listen       [::]:80 default_server;
		server_name  _;
		root         /usr/share/nginx/html;

		# Load configuration files for the default server block.
		include /etc/nginx/default.d/*.conf;

		location / {
		}

		error_page 404 /404.html;
			location = /40x.html {
		}

		error_page 500 502 503 504 /50x.html;
			location = /50x.html {
		}
	}
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">检查配置</div>
<p><code>nginx -t</code></p>
</div>
<div class="paragraph">
<div class="title">启动Nginx</div>
<p><code>systemctl start nginx</code></p>
</div>
<div class="paragraph">
<div class="title">查看Nginx状态</div>
<p><code>systemctl status nginx</code></p>
</div>
<div class="paragraph">
<div class="title">增加开机启动</div>
<p><code>systemctl enable nginx</code></p>
</div>
<div class="paragraph">
<div class="title">查看版本号</div>
<p><code>nginx -v</code></p>
</div>
<div class="paragraph">
<div class="title">卸载nginx</div>
<p><code>dnf remove nginx</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_安装_mysql_2">5.3.2. 安装 MySQL</h4>
<div class="paragraph">
<div class="title">安装 MySQL</div>
<p><code>yum install -y mariadb-server</code></p>
</div>
<div class="paragraph">
<div class="title">备份 my.cnf</div>
<p><code>cp /etc/my.cnf /etc/my.cnf.default</code></p>
</div>
<div class="listingblock">
<div class="title">修改 my.cnf</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /etc/my.cnf
[mysqld]
datadir=/var/lib/mysql
socket=/var/lib/mysql/mysql.sock
# Disabling symbolic-links is recommended to prevent assorted security risks
symbolic-links=0
# Settings user and group are ignored when systemd is used.
# If you need to run mysqld under a different user or group,
# customize your systemd unit file for mariadb according to the
# instructions in http://fedoraproject.org/wiki/Systemd

max_allowed_packet=20M
max_heap_table_size = 100M
read_buffer_size = 2M
read_rnd_buffer_size = 16M
sort_buffer_size = 8M
join_buffer_size = 8M
tmp_table_size = 100M

# 查询缓存
#query_cache_limit=4M
#query_cache_type=on
#query_cache_size=2G

bind-address = 127.0.0.1
# 跳过主机名解析，比如localhost，foo.com之类，加速访问
skip-name-resolve

# SQL执行日志
general_log=off
general_log_file=/var/log/mariadb/general.log

# SQL慢查询日志
slow_query_log=off
slow_query_log_file=/var/log/mariadb/slowquery.log
long_query_time = 5

max_connections = 1000

# 兼容老MySQL代码，比如使用空字符串代替NULL插入数据
sql_mode = ""

[mysqld_safe]
log-error=/var/log/mariadb/mariadb.log
pid-file=/var/run/mariadb/mariadb.pid

#
# include all files from the config directory
#
!includedir /etc/my.cnf.d
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">增加开机启动</div>
<p><code>systemctl enable mariadb</code></p>
</div>
<div class="paragraph">
<div class="title">启动MySQL</div>
<p><code>systemctl start mariadb</code></p>
</div>
<div class="paragraph">
<div class="title">查看 MySQL 服务状态</div>
<p><code>systemctl status mariadb</code></p>
</div>
<div class="paragraph">
<div class="title">修改root密码</div>
<p><code>mysqladmin -uroot password "geek"</code></p>
</div>
<div class="listingblock">
<div class="title">删除测试数据库和空密码用户</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">mysql -uroot -pgeek -e 'show databases;'
mysql -uroot -pgeek -e 'drop database test;'
mysql -uroot -pgeek mysql -e 'delete from db;'
mysql -uroot -pgeek mysql -e 'delete from user where Password="";'
mysql -uroot -pgeek -e 'flush privileges;'</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_安装php7">5.3.3. 安装PHP7</h4>
<div class="paragraph">
<div class="title">增加SCL源</div>
<p><code>yum install -y centos-release-scl</code></p>
</div>
<div class="listingblock">
<div class="title">安装PHP7.2</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">dnf install -y \
		php  \
		php-bcmath \
		php-fpm \
		php-gd \
		php-intl \
		php-mbstring \
		php-mysqlnd \
		php-opcache \
		php-pdo \
		php-pecl-apcu \
		php-xmlrpc \
		php-devel</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">安装mlocate</div>
<p><code>dnf install -y mlocate</code></p>
</div>
<div class="paragraph">
<div class="title">更新</div>
<p><code>updatedb</code></p>
</div>
<div class="paragraph">
<div class="title">查找配置文件路径</div>
<p><code>locate php.ini</code></p>
</div>
<div class="listingblock">
<div class="title">修改php.ini</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">sed -i '197s/short_open_tag = Off/short_open_tag = On/' /etc/opt/rh/rh-php72/php.ini

# 禁止一些危险性高的函数
sed -i '314s/disable_functions =/disable_functions = system,exec,shell_exec,passthru,set_time_limit,ini_alter,dl,openlog,syslog,readlink,symlink,link,leak,popen,escapeshellcmd,virtual,socket_create,mail,eval/' /etc/opt/rh/rh-php72/php.ini

# 配置中国时区
sed -i '902s#;date.timezone =#date.timezone = Asia/Shanghai#' /etc/opt/rh/rh-php72/php.ini</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">增加开机启动</div>
<p><code>systemctl enable php-fpm</code></p>
</div>
<div class="paragraph">
<div class="title">启动 PHP-FPM 服务</div>
<p><code>systemctl start php-fpm</code></p>
</div>
<div class="paragraph">
<div class="title">查看 PHP-FPM 服务状态</div>
<p><code>systemctl status php-fpm</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_lnmp环境测试">5.3.4. LNMP环境测试</h4>
<div class="paragraph">
<div class="title">增加数据库</div>
<p><code>mysql -uroot -pgeek -e 'create database drupal;grant all privileges on drupal.* to drupal@"localhost" identified by "drupal_password";flush privileges;'</code></p>
</div>
<div class="listingblock">
<div class="title">增加Nginx Host设置</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /etc/nginx/conf.d/drupal.foo.com.conf
	server {
		listen       80;

		server_name  drupal.foo.com;
		root         /data/web/drupal.foo.com;
		error_log /var/log/nginx/drupal.foo.com_error.log;
		access_log /var/log/nginx/drupal.foo.com_access.log  main;

		location / {
			try_files \$uri /index.php\$is_args$query_string;
		}

		include /etc/nginx/default.d/php.conf;
	}
EOF</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">重载Nginx配置</div>
<p><code>nginx -s reload</code></p>
</div>
<div class="paragraph">
<div class="title">准备 Drupal</div>
<p><code>mkdir -p /data/web/drupal.foo.com</code></p>
</div>
<div class="listingblock">
<div class="title">使用 -O 参数指定保存文件名，会强制覆盖已经存在的文件</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">wget https://ftp.drupal.org/files/projects/drupal-8.7.10.tar.gz -O drupal-8.7.10.tar.gz
tar xf drupal-8.7.10.tar.gz
mv drupal-8.7.10/* /data/web/drupal.foo.com
rm -rf drupal-8.7.10
chown -R apache:nginx /data/web/drupal.foo.com
chmod -R 755 /data/web/drupal.foo.com</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">设置本地解析</div>
<p><code>echo '47.74.60.161 drupal.foo.com' &gt;&gt; /etc/hosts</code></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_XXL-JOB_chapter">6. XXL-JOB</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_安装配置">6.1. 安装配置</h3>
<div class="sect3">
<h4 id="_安装依赖">6.1.1. 安装依赖</h4>
<div class="sect4">
<h5 id="_git">Git</h5>
<div class="paragraph">
<p><code>yum install -y git</code></p>
</div>
</div>
<div class="sect4">
<h5 id="_maven_java_8">Maven &amp;&amp; Java 8</h5>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><code>Maven</code> 包默认依赖 Java 8。以下 Java 将被安装：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>java-1.8.0-openjdk</p>
</li>
<li>
<p>java-1.8.0-openjdk-devel</p>
</li>
<li>
<p>java-1.8.0-openjdk-headless</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>安装 Maven<br>
<code>yum install -y maven</code></p>
</div>
<div class="paragraph">
<p>查看 Maven 版本</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@geekcamp ~]# mvn --version
Apache Maven 3.0.5 (Red Hat 3.0.5-17)
Maven home: /usr/share/maven
Java version: 1.8.0_232, vendor: Oracle Corporation
Java home: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.232.b09-0.el7_7.x86_64/jre
Default locale: en_US, platform encoding: UTF-8
OS name: "linux", version: "3.10.0-1062.el7.x86_64", arch: "amd64", family: "unix"</code></pre>
</div>
</div>
<div class="paragraph">
<p>查看 Java 版本</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@geekcamp ~]# java -version
openjdk version "1.8.0_232"
OpenJDK Runtime Environment (build 1.8.0_232-b09)
OpenJDK 64-Bit Server VM (build 25.232-b09, mixed mode)</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置 <code>Maven</code> 全局镜像源</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">mkdir ~/.m2

cat &lt;&lt; EOF &gt; ~/.m2/settings.xml
&lt;settings&gt;
  &lt;mirrors&gt;
    &lt;mirror&gt;
      &lt;id&gt;aliyun&lt;/id&gt;
      &lt;name&gt;Aliyun Central&lt;/name&gt;
        &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;
      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;
&lt;/settings&gt;
EOF</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_java_11可选">Java 11（可选）</h5>
<div class="paragraph">
<p>安装 Java 11：<br>
<code>yum install -y java-11-openjdk java-11-openjdk-devel java-11-openjdk-headless</code></p>
</div>
<div class="paragraph">
<p>查看当前默认 Java 版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@geekcamp ~]# java -version
openjdk version "1.8.0_232"
OpenJDK Runtime Environment (build 1.8.0_232-b09)
OpenJDK 64-Bit Server VM (build 25.232-b09, mixed mode)

[root@geekcamp ~]# alternatives --display java
java - status is auto.
 link currently points to /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.232.b09-0.el7_7.x86_64/jre/bin/java
/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.232.b09-0.el7_7.x86_64/jre/bin/java - family java-1.8.0-openjdk.x86_64 priority 1800232
 slave jre: /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.232.b09-0.el7_7.x86_64/jre
......
Current `best' version is /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.232.b09-0.el7_7.x86_64/jre/bin/java.</code></pre>
</div>
</div>
<div class="paragraph">
<p>设置Java11为默认版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">alternatives --set java `ls /usr/lib/jvm/java-11-openjdk-*/bin/java`

alternatives --set jre_openjdk `ls -d /usr/lib/jvm/java-11-openjdk-*`

alternatives --set java_sdk_openjdk `ls -d /usr/lib/jvm/java-11-openjdk-*`</code></pre>
</div>
</div>
<div class="paragraph">
<p>查看当前默认 Java 版本：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@geekcamp ~]# java -version
openjdk version "11.0.6" 2020-01-14 LTS
OpenJDK Runtime Environment 18.9 (build 11.0.6+10-LTS)
OpenJDK 64-Bit Server VM 18.9 (build 11.0.6+10-LTS, mixed mode, sharing)</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_mysql_2">MySQL</h5>
<div class="paragraph">
<p>安装 <code>MySQL</code>：<br>
<code>yum install -y mariadb-server mariadb</code></p>
</div>
<div class="paragraph">
<p>设置开机启动：<br>
<code>systemctl enable mariadb</code></p>
</div>
<div class="paragraph">
<p>启动 <code>MySQL</code> 服务：<br>
<code>systemctl start mariadb</code></p>
</div>
<div class="paragraph">
<p>设置密码：<br>
<code>mysqladmin -uroot password "geek"</code></p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
默认 <code>MySQL</code> 初始化并启动后，可以使用空密码登录。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>测试 <code>MySQL</code>：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@geekcamp ~]# mysql -uroot -pgeek -e "show databases;"
+--------------------+
| Database           |
+--------------------+
| information_schema |
| mysql              |
| performance_schema |
| test               |
+--------------------+</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xxl_job_安装">6.1.2. XXL-JOB 安装</h4>
<div class="paragraph">
<p>构建：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[ ! -d "~/downloads/" ] &amp;&amp; mkdir ~/downloads/
cd ~/downloads/
git clone https://github.com/xuxueli/xxl-job.git
cd xxl-job
mvn -T 4 package</code></pre>
</div>
</div>
<div class="paragraph">
<p>安装：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[ ! -d "/data/xxl-job/admin" ] &amp;&amp; mkdir -p /data/xxl-job/admin
[ ! -d "/data/xxl-job/executor" ] &amp;&amp; mkdir -p /data/xxl-job/executor
[ ! -d "/data/applogs" ] &amp;&amp; mkdir -p /data/applogs

echo y | cp xxl-job-admin/target/xxl-job-admin-2.2.0-SNAPSHOT.jar /data/xxl-job/admin
echo y | cp xxl-job-admin/src/main/resources/application.properties /data/xxl-job/admin

echo y | cp xxl-job-executor-samples/xxl-job-executor-sample-springboot/target/xxl-job-executor-sample-springboot-2.2.0-SNAPSHOT.jar /data/xxl-job/executor
echo y | cp xxl-job-executor-samples/xxl-job-executor-sample-springboot/src/main/resources/application.properties /data/xxl-job/executor</code></pre>
</div>
</div>
<div class="paragraph">
<p>确认安装：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[root@geekcamp xxl-job]# find /data/xxl-job/*
/data/xxl-job/admin
/data/xxl-job/admin/xxl-job-admin-2.2.0-SNAPSHOT.jar
/data/xxl-job/admin/application.properties
/data/xxl-job/executor
/data/xxl-job/executor/xxl-job-executor-sample-springboot-2.2.0-SNAPSHOT.jar
/data/xxl-job/executor/application.properties</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_xxl_job_运行前">6.1.3. XXL-JOB 运行前</h4>
<div class="sect4">
<h5 id="_xxl_job_服务端">XXL-JOB 服务端</h5>
<div class="sect5">
<h6 id="_mysql配置">MySQL配置</h6>
<div class="paragraph">
<p>创建 <code>xxl_job</code> 数据库：</p>
</div>
<div class="paragraph">
<p><code>mysql -uroot -pgeek -e "CREATE DATABASE xxl_job DEFAULT CHARACTER SET utf8mb4 DEFAULT COLLATE utf8mb4_unicode_ci;"</code></p>
</div>
<div class="paragraph">
<p>创建 <code>xxl_job</code> 用户：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">mysql -uroot -pgeek -e "CREATE USER 'xxl_job'@'localhost' IDENTIFIED BY 'geek';"
mysql -uroot -pgeek -e "GRANT ALL ON xxl_job.* TO 'xxl_job'@'localhost' WITH GRANT OPTION;"</code></pre>
</div>
</div>
<div class="paragraph">
<p>导入 SQL 文件：</p>
</div>
<div class="paragraph">
<p><code>mysql -uxxl_job -pgeek xxl_job &lt; doc/db/tables_xxl_job.sql</code></p>
</div>
<div class="paragraph">
<p>查看 <code>xxl_job</code> 表：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@geekcamp xxl-job]# mysql -uxxl_job -pgeek xxl_job -e "show tables;"
+--------------------+
| Tables_in_xxl_job  |
+--------------------+
| xxl_job_group      |
| xxl_job_info       |
| xxl_job_lock       |
| xxl_job_log        |
| xxl_job_log_report |
| xxl_job_logglue    |
| xxl_job_registry   |
| xxl_job_user       |
+--------------------+</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_设置配置文件">设置配置文件</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">sed -i '26s/spring.datasource.username=root/spring.datasource.username=xxl_job/' /data/xxl-job/admin/application.properties

sed -i '27s/spring.datasource.password=root_pwd/spring.datasource.password=geek/' /data/xxl-job/admin/application.properties</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_创建系统用户">创建系统用户</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">useradd --user-group --no-create-home --shell /sbin/nologin --comment "XXL-JOB" xxl_job
chown -R xxl_job:xxl_job /data/applogs /data/xxl-job</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_增加_systemd_文件">增加 systemd 文件</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /usr/lib/systemd/system/xxl_job_admin.service
[Unit]
Description=XXL-JOB Admin Service
After=network.target remote-fs.target nss-lookup.target

[Service]
Type=simple
Environment="PORT=8080"
Environment="CONFIG_FILE=/data/xxl-job/admin/application.properties"
Environment="JAR_FILE=/data/xxl-job/admin/xxl-job-admin-2.2.0-SNAPSHOT.jar"

User=xxl_job
Group=xxl_job
WorkingDirectory=/data/xxl-job/admin
ExecStart=/usr/bin/java -Dserver.port=\${PORT} -Dspring.config.location=\${CONFIG_FILE} -jar \${JAR_FILE}
SuccessExitStatus=143
StandardOutput=null
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF</code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_xxl_job_客户端">XXL-JOB 客户端</h5>
<div class="sect5">
<h6 id="_创建目录">创建目录</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[ ! -d "/data/xxl-job/executor" ] &amp;&amp; mkdir -p /data/xxl-job/executor
[ ! -d "/data/applogs" ] &amp;&amp; mkdir -p /data/applogs</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_设置配置文件_2">设置配置文件</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">sed -i '9s#xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin#xxl.job.admin.addresses=http://192.168.2.11:8080/xxl-job-admin#' \
/data/xxl-job/executor/application.properties

appname=xxl-job-executor-s01

sed -i "12s/xxl.job.executor.appname=xxl-job-executor-sample/xxl.job.executor.appname=${appname}/" \
/data/xxl-job/executor/application.properties</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="dlist">
<dl>
<dt class="hdlist1">按需更改参数</dt>
<dd>
<p>xxl.job.admin.addresses=http://127.0.0.1:8080/xxl-job-admin</p>
</dd>
</dl>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_创建系统用户_2">创建系统用户</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">useradd --user-group --no-create-home --shell /sbin/nologin --comment "XXL-JOB" xxl_job
chown -R xxl_job:xxl_job /data/applogs /data/xxl-job/executor</code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_增加_systemd_文件_2">增加 systemd 文件</h6>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /usr/lib/systemd/system/xxl_job_executor.service
[Unit]
Description=XXL-JOB Executor Service
After=network.target remote-fs.target nss-lookup.target

[Service]
Type=simple
Environment="PORT=8081"
Environment="CONFIG_FILE=/data/xxl-job/executor/application.properties"
Environment="JAR_FILE=/data/xxl-job/executor/xxl-job-executor-sample-springboot-2.2.0-SNAPSHOT.jar"

User=xxl_job
Group=xxl_job
WorkingDirectory=/data/xxl-job/executor
ExecStart=/usr/bin/java -Dserver.port=\${PORT} -Dspring.config.location=\${CONFIG_FILE} -jar \${JAR_FILE}
SuccessExitStatus=143
StandardOutput=null
StandardError=journal

[Install]
WantedBy=multi-user.target
EOF</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_启动_xxl_job_服务端">6.1.4. 启动 XXL-JOB 服务端</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">systemctl enable xxl_job_admin
systemctl start xxl_job_admin</code></pre>
</div>
</div>
<div class="paragraph">
<p>确认运行情况：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@geekcamp xxl-job]# systemctl status xxl_job_admin
● xxl_job.service - XXL-JOB Service
   Loaded: loaded (/usr/lib/systemd/system/xxl_job.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2020-01-16 13:56:05 CST; 1s ago
 Main PID: 3015 (java)
   CGroup: /system.slice/xxl_job.service
           └─3015 /usr/bin/java -Dserver.port=8080 -Dspring.config.location=/data/xxl-job/application.properties -jar /data/xxl-job/xxl-job-admin-2.2.0-SNA...

Jan 16 13:56:05 geekcamp systemd[1]: Started XXL-JOB Service.

[root@geekcamp xxl-job]# ss -antpl|grep 8080
LISTEN     0      100       [::]:8080                  [::]:*                   users:(("java",pid=2288,fd=21))</code></pre>
</div>
</div>
<div class="paragraph">
<p>最后，浏览器访问 <a href="http://localhost:8080/xxl-job-admin" class="bare">http://localhost:8080/xxl-job-admin</a></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>XXL-JOB默认帐号：admin<br>
XXL-JOB默认密码：123456</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="_启动_xxl_job_客户端">6.1.5. 启动 XXL-JOB 客户端</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">systemctl enable xxl_job_executor
systemctl start xxl_job_executor</code></pre>
</div>
</div>
<div class="paragraph">
<p>确认运行情况：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs">[root@localhost admin]# systemctl status xxl_job_executor
● xxl_job_client.service - XXL-JOB Client
   Loaded: loaded (/usr/lib/systemd/system/xxl_job_client.service; enabled; vendor preset: disabled)
   Active: active (running) since Thu 2020-01-16 18:49:43 CST; 4s ago
 Main PID: 2876 (java)
   CGroup: /system.slice/xxl_job_client.service
           └─2876 /usr/bin/java -Dserver.port=8081 -Dspring.config.location=/data/xxl-job/executor/application.properties -jar /data/xxl-job/executor/xxl-j...

Jan 16 18:49:43 localhost.localdomain systemd[1]: Started XXL-JOB Client.

[root@localhost admin]# ss -antpl|grep 8081
LISTEN     0      100       [::]:8081                  [::]:*                   users:(("java",pid=4679,fd=11))</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_工作状态确认">6.1.6. 工作状态确认</h4>
<div class="paragraph">
<p>访问 <a href="http://192.168.2.11:8080/xxl-job-admin/jobgroup" class="bare">http://192.168.2.11:8080/xxl-job-admin/jobgroup</a> 并登录，确认结果与下图一致：</p>
</div>
<div class="imageblock">
<div class="content">
<img src="images/xxl_job_admin_jobgroup.jpg" alt="xxl job admin jobgroup">
</div>
<div class="title">Figure 1. XXL-JOB 执行器界面</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Kvm_chapter">7. Kvm</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>基于 CentOS 7</strong></p>
</div>
<div class="sect2">
<h3 id="_安装配置_2">7.1. 安装配置</h3>
<div class="sect3">
<h4 id="_安装kvm环境">7.1.1. 安装kvm环境</h4>
<div class="paragraph">
<p><code>yum install -y virt-manager libvirt virt-install qemu-kvm bridge-utils</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs"># lsmod | grep kvm

kvm_intel       138567  0
kvm             441119  1 kvm_intel</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">systemctl start libvirtd

systemctl enable libvirtd

echo "net.ipv4.ip_forward = 1" &gt;&gt; /etc/sysctl.conf
sysctl -p</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_设置网桥">7.1.2. 设置网桥</h4>
<div class="sect4">
<h5 id="_设置内网网桥和_dhcp">设置内网网桥和 DHCP</h5>
<div class="paragraph">
<p>编辑 <code>/etc/libvirt/qemu/networks/default.xml</code>，修改IP段为 <code>192.168.122.0/24，stp='on'</code></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="xml" class="language-xml hljs">&lt;network&gt;
  &lt;name&gt;default&lt;/name&gt;
  &lt;uuid&gt;9719a6f8-7e16-4e7b-a592-909337ddaf73&lt;/uuid&gt;
  &lt;forward mode='nat'/&gt;
  &lt;bridge name='virbr0' stp='on' delay='0'/&gt;
  &lt;mac address='52:54:00:dd:9e:e0'/&gt;
  &lt;ip address='192.168.122.1' netmask='255.255.255.0'&gt;
    &lt;dhcp&gt;
      &lt;range start='192.168.122.2' end='192.168.122.254'/&gt;
    &lt;/dhcp&gt;
  &lt;/ip&gt;
&lt;/network&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>编辑 <code>/var/lib/libvirt/dnsmasq/default.conf</code></p>
</div>
<div class="paragraph">
<p><code>dhcp-range=192.168.122.2,192.168.122.254</code></p>
</div>
<div class="listingblock">
<div class="title">重启libvirtd</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">systemctl restart libvirtd
brctl stp virbr0 on</code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_查看默认网桥virbr0">查看默认网桥virbr0</h5>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="console" class="language-console hljs"># ip a
4: virbr0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN
    link/ether 52:54:00:dd:9e:e0 brd ff:ff:ff:ff:ff:ff
    inet 192.168.122.1/24 brd 192.168.122.255 scope global virbr0
       valid_lft forever preferred_lft forever
5: virbr0-nic: &lt;BROADCAST,MULTICAST&gt; mtu 1500 qdisc pfifo_fast master virbr0 state DOWN qlen 500
    link/ether 52:54:00:dd:9e:e0 brd ff:ff:ff:ff:ff:ff

# brctl show
bridge name	bridge id		STP enabled	interfaces
virbr0		8000.525400dd9ee0	off		virbr0-nic</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_配置公网网桥使虚拟机可以绑定公网ip">7.1.3. 配置公网网桥，使虚拟机可以绑定公网IP</h4>
<div class="listingblock">
<div class="title">nmcli依赖于NetworkManager服务</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">systemctl unmask NetworkManager
systemctl start NetworkManager
systemctl status NetworkManager</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">添加物理网卡</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">nmcli c add type Ethernet autoconnect yes con-name eth2 ifname eth2
nmcli c add type bridge autoconnect yes con-name br1 ifname br1
nmcli c modify br1 bridge.stp no
nmcli c modify br1 ipv6.method ignore
nmcli c modify br1 ipv4.addresses 182.131.21.23/28 ipv4.method manual
nmcli c modify br1 ipv4.gateway 182.131.21.1
nmcli c modify br1 ipv4.dns "223.5.5.5 223.6.6.6"</code></pre>
</div>
</div>
<div class="paragraph">
<p>删除物理网卡em1，将网卡加入网桥。em1的IP地址也自动加入到了网桥。</p>
</div>
<div class="paragraph">
<p>以下3条命令必须同时执行，最好放到脚本里面执行。因为，delete网卡后，可能会断网。重启网络服务或启动网桥后才能恢复</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
将em1换成自己的网卡
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; /tmp/set_br1.sh
nmcli c delete em1
nmcli c add type bridge-slave autoconnect yes con-name em1 ifname em1 master br1
nmcli c up br1
EOF

chmod 755 /tmp/set_br1.sh
sh /tmp/set_br1.sh &amp;
rm -f /tmp/set_br1.sh</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">重启网络</div>
<p><code>systemctl restart NetworkManager</code><br>
<code>systemctl status NetworkManager</code>
<code>reboot</code></p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
CentOS 7 上意外关闭了 NetworkManager 服务，重启后导致无法访问网络。注意，保持NetworkManager开机运行。
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_kvm虚拟机">7.2. KVM虚拟机</h3>
<div class="sect3">
<h4 id="_挂载硬盘">7.2.1. 挂载硬盘</h4>
<div class="paragraph">
<div class="title">查看硬盘</div>
<p><code>fdisk -l</code></p>
</div>
<div class="paragraph">
<div class="title">硬盘分区</div>
<p><code>fdisk /dev/sdb</code></p>
</div>
<div class="paragraph">
<div class="title">格式化</div>
<p><code>mkfs.xfs -n ftype=1 -f /dev/sdb1</code></p>
</div>
<div class="paragraph">
<div class="title">查看uuid</div>
<p><code>blkid</code></p>
</div>
<div class="listingblock">
<div class="title">添加到 <code>/etc/fstab</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">UUID=0836d695-2bb4-48db-a440-faccc6131761 /mnt                       xfs     defaults        0 0</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">开机启动</div>
<p><code>mount -a</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_虚拟机安装">7.2.2. 虚拟机安装</h4>
<div class="paragraph">
<div class="title">增加虚拟机硬盘</div>
<p><code>qemu-img create -f qcow2 /var/lib/libvirt/images/vm192168122253.img 100G</code></p>
</div>
<div class="listingblock">
<div class="title">安装 vir</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">virt-install \
--name centos_kvm \
--ram 4096 \
--disk path=/var/lib/libvirt/images/vm192168122253.img,size=100 \
--vcpus 2 \
--os-type linux \
--os-variant centos7.0 \
--network bridge=br1 \
--console pty,target_type=serial \
--cdrom=/data/CentOS-7-x86_64-Minimal-1908.iso \
--graphics vnc,password=geek,port=-1,listen=0.0.0.0</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">已有虚拟机镜像安装</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">virt-install \
--name gitlab \
--ram 2048 \
--disk path=/data/package/gitlab_centos7.img \
--vcpus 4 \
--os-type linux \
--os-variant centos7.0 \
--network bridge=br1 \
--console pty,target_type=serial \
--import \
--graphics vnc,password=geek,port=5901,listen=0.0.0.0</code></pre>
</div>
</div>
<div class="dlist">
<div class="title">参数解释</div>
<dl>
<dt class="hdlist1"><code>--name centos_kvm</code> </dt>
<dd>
<p>虚拟机名称</p>
</dd>
<dt class="hdlist1"><code>--ram 4096</code> </dt>
<dd>
<p>虚拟机内存</p>
</dd>
<dt class="hdlist1"><code>--disk path=/var/lib/libvirt/images/vm192168122253.img,size=100</code> </dt>
<dd>
<p>硬盘位置大小</p>
</dd>
<dt class="hdlist1"><code>--vcpus 2</code> </dt>
<dd>
<p>cpu数量</p>
</dd>
<dt class="hdlist1"><code>--os-type linux</code> </dt>
<dd>
<p>系统类型</p>
</dd>
<dt class="hdlist1"><code>--os-variant centos7.0</code> </dt>
<dd>
<p><code>osinfo-query os|grep -i centos</code> 查系统类型</p>
</dd>
<dt class="hdlist1"><code>--network bridge=br1</code> </dt>
<dd>
<p>网桥名称</p>
</dd>
<dt class="hdlist1"><code>--console pty,target_type=serial</code> </dt>
<dd>
<p>默认参数</p>
</dd>
<dt class="hdlist1"><code>--cdrom=/data/CentOS-7-x86_64-Minimal-1908.iso</code> </dt>
<dd>
<p>ios位置</p>
</dd>
<dt class="hdlist1"><code>--graphics vnc,password=geek,port=-1,listen=0.0.0.0</code> </dt>
<dd>
<p>vnc服务，密码，端口，-1不指定端口</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">开启虚拟机</div>
<p><code>virsh start vir-name</code></p>
</div>
<div class="paragraph">
<div class="title">查看虚拟机</div>
<p><code>virsh list --all</code></p>
</div>
<div class="paragraph">
<div class="title">删除虚拟机</div>
<p><code>virsh undefine  centos_kvm</code></p>
</div>
<div class="paragraph">
<div class="title">设置开机启动</div>
<p>virsh autostart vir_name</p>
</div>
<div class="paragraph">
<div class="title">关闭开机启动</div>
<p>virsh autostart --disable vir_name</p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Service_chapter">8. Service</h2>
<div class="sectionbody">
<div class="paragraph">
<p><strong>基于 CentOS 7</strong></p>
</div>
<div class="sect2">
<h3 id="_systemd">8.1. systemd</h3>
<div class="sect3">
<h4 id="_service_文件">8.1.1. <code>.service</code> 文件</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在 <code>/usr/lib/systemd/system</code> 目录下创建服务配置 <code>backdump.service</code> 文件</p>
</div>
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">编辑 <code>backdump.service</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">[Unit]
Description=mysql dump

[Service]
Type=oneshot
ExecStart=/usr/lib/locale/mysqldump.sh
IOSchedulingClass=idle

[Install]
WantedBy=multi-user.target</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">编辑 <code>mysqldump.sh</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">#!/bin/bash
/usr/bin/mysqldump -uroot -p'geek' --add-drop-table dedecms_foo_com &gt; dedecms_foo_com`date +%Y%m%d%H%M%S`.sql|tar -zcvf /data/db/dedecms_foo_com`date +%Y%m%d%H%M%S`.sql.tar.gz dedecms_foo_com`date +%Y%m%d%H%M%S`.sql
rsync -a --log-file=/tmp/rsync.log /data/web/ root@192.168.2.8:/data/backup/web
rsync -a --log-file=/tmp/rsync.log /data/db/ root@192.168.2.8:/data/backup/db</code></pre>
</div>
</div>
<div class="dlist">
<div class="title">参数解释</div>
<dl>
<dt class="hdlist1"><code>[Unit]</code> </dt>
<dd>
<p>通常是配置文件的第一个区块，用来定义 Unit 的元数据</p>
</dd>
<dt class="hdlist1"><code>Description</code> </dt>
<dd>
<p>关于服务的简短描述</p>
</dd>
<dt class="hdlist1"><code>[Service]</code> </dt>
<dd>
<p><code>service</code> 的配置区块，编写配置</p>
</dd>
<dt class="hdlist1"><code>Type</code> </dt>
<dd>
<p>定义进程启动时的行为，<code>oneshot</code> 一次性进程，参数如下</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">Type=simple：默认值，执行ExecStart指定的命令，启动主进程
Type=forking：以 fork 方式从父进程创建子进程，创建后父进程会立即退出
Type=oneshot：一次性进程，Systemd 会等当前服务退出，再继续往下执行
Type=dbus：当前服务通过D-Bus启动
Type=notify：当前服务启动完毕，会通知Systemd，再继续往下执行
Type=idle：若有其他任务执行完毕，当前服务才会运行</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>ExecStart</code> </dt>
<dd>
<p>启动当前服务的命令，加命令的绝对路径</p>
</dd>
<dt class="hdlist1"><code>[Install]</code> </dt>
<dd>
<p>配置文件的最后一个区块，用来定义如何启动，以及是否开机启动</p>
</dd>
<dt class="hdlist1"><code>WantedBy</code> </dt>
<dd>
<p>表示该服务所在的 Target，<code>WantedBy=multi-user.target</code> 指的是，sshd 所在的 Target 是multi-user.target</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_timer_定时器文件">8.1.2. <code>.timer</code> 定时器文件</h4>
<div class="paragraph">
<p>在 <code>/usr/lib/systemd/system</code> 目录下创建服务配置 <code>.timer</code> 文件
<code>mkdir /usr/lib/systemd/system/backdump.timer</code></p>
</div>
<div class="listingblock">
<div class="title">编辑 <code>backdump.timer</code> 文件</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[Unit]
Description=mysql dump

[Timer]
OnCalendar=hourly

[Install]
WantedBy=timers.target</code></pre>
</div>
</div>
<div class="dlist">
<div class="title">参数解释</div>
<dl>
<dt class="hdlist1"><code>[Unit]</code> </dt>
<dd>
<p>通常是配置文件的第一个区块，用来定义 Unit 的元数据</p>
</dd>
<dt class="hdlist1"><code>Description</code> </dt>
<dd>
<p>关于服务的简短描述</p>
</dd>
<dt class="hdlist1"><code>[Service]</code> </dt>
<dd>
<p><code>service</code> 的配置区块，编写配置</p>
</dd>
<dt class="hdlist1"><code>OnCalendar</code> </dt>
<dd>
<p>定义基于挂钟时间(wallclock)的日历定时器，值是一个日历事件表达式，指定时间触发</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="test" class="language-test hljs">    minutely → *-*-* *:*:00
      hourly → *-*-* *:00:00
       daily → *-*-* 00:00:00
     monthly → *-*-01 00:00:00
      weekly → Mon *-*-* 00:00:00
      yearly → *-01-01 00:00:00
   quarterly → *-01,04,07,10-01 00:00:00
semiannually → *-01,07-01 00:00:00

相关的服务，参数如下
[Timer]部分定制定时器。Systemd 提供以下一些字段。

OnActiveSec：定时器生效后，多少时间开始执行任务
OnBootSec：系统启动后，多少时间开始执行任务
OnStartupSec：Systemd 进程启动后，多少时间开始执行任务
OnUnitActiveSec：该单元上次执行后，等多少时间再次执行
OnUnitInactiveSec： 定时器上次关闭后多少时间，再次执行
OnCalendar：基于绝对时间，而不是相对时间执行
AccuracySec：如果因为各种原因，任务必须推迟执行，推迟的最大秒数，默认是60秒
Unit：真正要执行的任务，默认是同名的带有.service后缀的单元
Persistent：如果设置了该字段，即使定时器到时没有启动，也会自动执行相应的单元
WakeSystem：如果系统休眠，是否自动唤醒系统</code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>WantedBy</code> </dt>
<dd>
<p>表示该服务所在的 Target，<code>WantedBy=timers.target</code> 指的是，sshd 所在的 Target 是timers.target</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_启动_service">8.1.3. 启动 <code>service</code></h4>
<div class="paragraph">
<div class="title">启动  <code>backdump.service</code></div>
<p><code>systemctl start backdump</code></p>
</div>
<div class="paragraph">
<div class="title">查看服务状态</div>
<p><code>systemctl status backdump</code></p>
</div>
<div class="paragraph">
<div class="title">增加开机自启</div>
<p><code>systemctl enable backdump</code></p>
</div>
<div class="paragraph">
<div class="title">修改服务文件后重载服务</div>
<p><code>systemctl daemon-reload</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_启动_timer_服务">8.1.4. 启动 <code>timer</code> 服务</h4>
<div class="paragraph">
<div class="title">启动 <code>backdump.timer</code></div>
<p><code>systemctl start backdump.timer</code></p>
</div>
<div class="paragraph">
<div class="title">查看所有已启用的定时器</div>
<p><code>systemctl list-timers</code></p>
</div>
<div class="paragraph">
<div class="title">增加开机自启</div>
<p><code>systemctl enable backdump.timer</code></p>
</div>
<div class="paragraph">
<div class="title">重启 <code>backdump.timer</code></div>
<p><code>systemctl restart backdump.timer</code></p>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Python38_chapter">9. Python38</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_centos7_install_python38">9.1. CentOS7 Install Python38</h3>
<div class="sect3">
<h4 id="_二进制压缩包安装">9.1.1. 二进制压缩包安装</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">wget http://dl.cdgeekcamp.com/centos/7/python/3/python-3.8.1-1.el7.x86_64.tar.gz -O python-3.8.1-1.el7.x86_64.tar.gz

tar xf python-3.8.1-1.el7.x86_64.tar.gz

rm -rf /usr/local/python-3.8.1
mv python-3.8.1 /usr/local/python-3.8.1

ln -s /usr/local/python-3.8.1 /usr/local/python3
ln -s /usr/local/python3/bin/pip3 /usr/local/bin/pip38
ln -s /usr/local/python3/bin/python3 /usr/local/bin/python38

pip38 install --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simple pip
pip38 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_centos8_install_python38">9.2. CentOS8 Install Python38</h3>
<div class="sect3">
<h4 id="_二进制压缩包安装_2">9.2.1. 二进制压缩包安装</h4>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">wget http://dl.cdgeekcamp.com/centos/8/python/3/python-3.8.1-1.el8.x86_64.tar.gz -O python-3.8.1-1.el8.x86_64.tar.gz

tar xf python-3.8.1-1.el8.x86_64.tar.gz

rm -rf /usr/local/python-3.8.1
mv python-3.8.1 /usr/local/python-3.8.1

ln -s /usr/local/python-3.8.1 /usr/local/python3
ln -s /usr/local/python3/bin/pip3 /usr/local/bin/pip38
ln -s /usr/local/python3/bin/python3 /usr/local/bin/python38

pip38 install --upgrade -i https://pypi.tuna.tsinghua.edu.cn/simple pip
pip38 config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Java_chapter">10. Java</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_maven_安装">10.1. <code>maven</code> 安装</h3>
<div class="listingblock">
<div class="title">安装maven  (配置环境变量)</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">wget http://ftp.meisei-u.ac.jp/mirror/apache/dist/maven/maven-3/3.6.3/binaries/apache-maven-3.6.3-bin.tar.gz
tar -xf apache-maven-3.6.3-bin.tar.gz
mv apache-maven-3.6.3-bin.tar.gz /usr/local/

#添加环境变量
ln -s /usr/local/apache-maven-3.6.3/bin/mvn /usr/local/bin/

#查看版本
mvn -v</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">全局源</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; ~/.m2/settings.xml
&lt;settings&gt;
  &lt;mirrors&gt;
    &lt;mirror&gt;
      &lt;id&gt;aliyun&lt;/id&gt;
      &lt;name&gt;Aliyun Central&lt;/name&gt;
        &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;
      &lt;mirrorOf&gt;central&lt;/mirrorOf&gt;
    &lt;/mirror&gt;
  &lt;/mirrors&gt;
&lt;/settings&gt;
EOF</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_nodejs_安装">10.2. <code>nodejs</code> 安装</h3>
<div class="listingblock">
<div class="title">nodejs版本 12</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">wget https://nodejs.org/dist/v12.16.1/node-v12.16.1-linux-x64.tar.xz
tar -xf node-v12.16.1-linux-x64.tar.xz
mv node-v12.16.1-linux-x64 nodejs
mv nodejs /usr/local/

#环境变量
ln -s /usr/local/nodejs/bin/npm /usr/local/bin/
ln -s /usr/local/nodejs/bin/node /usr/local/bin/
#设置淘宝源
npm config set registry https://registry.npm.taobao.org</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_DNS_chapter">11. DNS</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_dns_服务搭建">11.1. <code>DNS</code> 服务搭建</h3>
<div class="paragraph">
<div class="title">安装 <code>bind</code></div>
<p><code>yum install bind-chroot bind-utils</code><br>
<code>systemctl enable named-chroot</code></p>
</div>
<div class="listingblock">
<div class="title">配置 <code>bind</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">options {
        listen-on port 53 { any; };
        listen-on-v6 port 53 { ::1; };
        directory       "/var/named";
        dump-file       "/var/named/data/cache_dump.db";
        statistics-file "/var/named/data/named_stats.txt";
        memstatistics-file "/var/named/data/named_mem_stats.txt";
#       recursing-file  "/var/named/data/named.recursing";
#       secroots-file   "/var/named/data/named.secroots";
        allow-query     { any; };
        recursion yes;

        dnssec-enable no;
        dnssec-validation no;

        /* Path to ISC DLV key */
        bindkeys-file "/etc/named.root.key";

        managed-keys-directory "/var/named/dynamic";

        pid-file "/run/named/named.pid";
        session-keyfile "/run/named/session.key";
};

logging {
        channel default_debug {
                file "data/named.run";
                severity dynamic;
        };
};

zone "." IN {
        type hint;
        file "named.ca";
};

include "/etc/named.rfc1912.zones";
include "/etc/named.root.key";</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">添加正向解析域</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">vim /etc/named.rfc1912.zones

zone "xyt.com" IN {
        type master;
        file "xyt.com.zone";
        allow-update { none; };
};


cat /var/named/xyt.com.zone
$TTL 86400
@       IN      SOA      xytdt.com.     admin.xytdt.com. (
                                        102310111
                                        1D
                                        1H
                                        1W
                                        3H )

@               IN      NS      xytdt.com.
@               IN      A       10.10.10.11
oa              IN      A       10.10.10.13
cloud           IN      A       10.10.10.18</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">启动 <code>bind</code></div>
<p><code>systemctl start named-chroot</code></p>
</div>
<div class="listingblock">
<div class="title">检查配置</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">[root@localhost ~]# named-checkzone "ooxx.com" /var/named/ooxx.com.zone
zone ooxx.com/IN: loaded serial 0
OK</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Docker_chapter">12. Docker</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_docker">12.1. <code>Docker</code></h3>
<div class="sect3">
<h4 id="_安装_2">12.1.1. 安装</h4>
<div class="listingblock">
<div class="title">安装</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">sudo yum install -y yum-utils
sudo yum-config-manager \
    --add-repo \
    https://mirrors.ustc.edu.cn/docker-ce/linux/centos/docker-ce.repo

sudo sed -i 's/download.docker.com/mirrors.ustc.edu.cn\/docker-ce/g' /etc/yum.repos.d/docker-ce.repo

# 官方源
# $ sudo yum-config-manager \
#     --add-repo \
#     https://download.docker.com/linux/centos/docker-ce.repo


sudo yum install -y docker-ce docker-ce-cli containerd.io



sudo systemctl enable docker
sudo systemctl start docker</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">自动化脚本安装</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs"># $ curl -fsSL test.docker.com -o get-docker.sh
curl -fsSL get.docker.com -o get-docker.sh
sudo sh get-docker.sh --mirror Aliyun
# $ sudo sh get-docker.sh --mirror AzureChinaCloud</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_常用命令">12.1.2. 常用命令</h4>
<div class="paragraph">
<div class="title">拉取镜像</div>
<p><code>docker pull [选项] [Docker Registry 地址[:端口号]/]仓库名[:标签]</code></p>
</div>
<div class="paragraph">
<div class="title">运行</div>
<p><code>docker run -itd --name nginx1 test/ubuntu:v1.0 /bin/bash</code></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1"><code>-i</code> </dt>
<dd>
<p>交互式操作</p>
</dd>
<dt class="hdlist1"><code>-t</code> </dt>
<dd>
<p>终端</p>
</dd>
<dt class="hdlist1"><code>-d</code> </dt>
<dd>
<p>后台运行</p>
</dd>
<dt class="hdlist1"><code>--name</code> </dt>
<dd>
<p>容器名称</p>
</dd>
</dl>
</div>
<div class="paragraph">
<div class="title">终止</div>
<p><code>docker stop ID</code></p>
</div>
<div class="paragraph">
<div class="title">重启</div>
<p><code>docker restart ID</code></p>
</div>
<div class="paragraph">
<div class="title">进入容器, <code>attach</code> 退出会导致容器终止， ``</div>
<p><code>docker attach ID</code><br>
<code>docker exec -it ID /bin/bash</code></p>
</div>
<div class="paragraph">
<div class="title">列出镜像</div>
<p><code>docker images</code><br>
<code>docker image ls -a</code></p>
</div>
<div class="paragraph">
<div class="title">列出所有容器</div>
<p><code>docker container ls -a</code></p>
</div>
<div class="paragraph">
<div class="title">获取容器的输出信息</div>
<p><code>docker container logs ID</code></p>
</div>
<div class="paragraph">
<div class="title">镜像体积</div>
<p><code>docker system df</code></p>
</div>
<div class="paragraph">
<div class="title">删除镜像</div>
<p><code>docker image rm [选项] &lt;镜像1&gt; [&lt;镜像2&gt; &#8230;&#8203;]</code></p>
</div>
<div class="paragraph">
<div class="title">导出容器</div>
<p><code>docker export 7691a814370e &gt; ubuntu.tar</code></p>
</div>
<div class="paragraph">
<div class="title">导入容器快照</div>
<p><code>cat ubuntu.tar | docker import - test/ubuntu:v1.0</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_dockerfile_定制镜像">12.1.3. <code>Dockerfile</code> 定制镜像</h4>
<div class="listingblock">
<div class="title">文件 <code>Dockerfile</code></div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="txt" class="language-txt hljs">$ mkdir mynginx
$ cd mynginx
$ touch Dockerfile

dockerfile

FROM debian:stretch

RUN apt-get update
COPY package.json /usr/src/app/  #复制文件，源路径 目标路径
ADD ubuntu-xenial-core-cloudimg-amd64-root.tar.gz / #高级文件复制，压缩文件自动解压，处理权限
CMD echo $HOME  #容器启动命令
USER &lt;用户名&gt;[:&lt;用户组&gt;]  #指定当前用户</code></pre>
</div>
</div>
<div class="paragraph">
<div class="title">构建镜像</div>
<p>在Dockerfile文件所在目录执行，-t指定镜像名称<br>
<code>docker build -t nginx:v3 .</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_docker仓库">12.1.4. Docker仓库</h4>
<div class="paragraph">
<div class="title">查找镜像</div>
<p><code>docker search centos</code><br>
<code>docker pull centos</code></p>
</div>
<div class="listingblock">
<div class="title">推送镜像 (登录才能使用)</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="text" class="language-text hljs">$ docker tag ubuntu:18.04 username/ubuntu:18.04

$ docker image ls

REPOSITORY                                               TAG                    IMAGE ID            CREATED             SIZE
ubuntu                                                   18.04                  275d79972a86        6 days ago          94.6MB
username/ubuntu                                          18.04                  275d79972a86        6 days ago          94.6MB

$ docker push username/ubuntu:18.04

$ docker search username

NAME                      DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
username/ubuntu</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_数据管理">12.1.5. 数据管理</h4>
<div class="paragraph">
<div class="title">创建一个数据卷</div>
<p><code>docker volume create my-vol</code></p>
</div>
<div class="paragraph">
<div class="title">查看所有的 数据卷</div>
<p><code>docker volume ls</code></p>
</div>
<div class="paragraph">
<div class="title">查看数据卷的信息</div>
<p><code>docker volume inspect first</code></p>
</div>
</div>
<div class="sect3">
<h4 id="_外部访问容器">12.1.6. 外部访问容器</h4>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_Ansible_chapter">13. Ansible</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_ansible">13.1. Ansible</h3>
<div class="sect3">
<h4 id="_安装_3">13.1.1. 安装</h4>
<div class="paragraph">
<div class="title">添加源</div>
<p><code>yum -y install epel-release</code></p>
</div>
<div class="paragraph">
<div class="title">安装</div>
<p><code>yum -y install ansible</code></p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
ansible.cfg 是 Ansible 工具的配置文件；<br>
hosts 用来配置被管理的机器；<br>
roles 是一个目录，playbook 将使用它
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ssh秘钥认证">13.2. SSH秘钥认证</h3>
<div class="paragraph">
<div class="title">生成密钥</div>
<p><code>ssh-keygen -N "" -f ~/.ssh/mk</code></p>
</div>
<div class="paragraph">
<div class="title">上传SSH公钥文件</div>
<p><code>ssh-copy-id -i ~/.ssh/mk.pub root@118.24.186.166</code></p>
</div>
<div class="listingblock">
<div class="title">创建配置文件</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">cat &lt;&lt; EOF &gt; ~/.ssh/config
IdentityFile ~/.ssh/mk
EOF</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_添加被管理主机">13.3. 添加被管理主机</h3>
<div class="listingblock">
<div class="title">添加主机</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">vim /etc/ansible/hosts

[test]
10.23.101.x
10.23.101.x</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">测试ansible</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[root@localhost ~]# ansible "test" -m ping
10.23.101.x | SUCCESS =&gt; {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/bin/python"
    },
    "changed": false,
    "ping": "pong"
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_ansible常用模块">13.4. ansible常用模块</h3>
<div class="paragraph">
<div class="title">command</div>
<p><code>ansible hostname -m command -a "free -m"</code></p>
</div>
<div class="paragraph">
<div class="title">script</div>
<p>script的功能是在远程主机执行主控端存储的 shell 脚本文件，相当于 scp + shell 组合。<br>
<code>ansible hostname -m script -a "/home/test.sh 12 34"</code></p>
</div>
<div class="paragraph">
<div class="title">shell模块基本和command相同，但是shell支持管道符</div>
<p><code>ansible hostname -m shell -a "/home/test.sh"</code></p>
</div>
<div class="paragraph">
<div class="title">copy模块 类似于SCP</div>
<p>向 Client 组中主机拷贝 test.sh 到 /tmp 下，属主、组为 root ，权限为 0755<br>
<code>ansible hostname -m copy -a "src=/home/test.sh dest=/tmp/ owner=root group=root mode=0755"</code></p>
</div>
</div>
<div class="sect2">
<h3 id="_ansible_playbook">13.5. ansible-playbook</h3>
<div class="paragraph">
<div class="title">YAML语法</div>
<p>YAML文件扩展名通常为.yaml或者.yml，一定要对齐，只能使用空格</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[root@localhost ~]# cat /etc/ansible/hellow.yml
---

- name: say 'hello world'
  hosts: test
  tasks:

    - name: echo 'hello world'
      command: echo 'hello world'
      register: result

    - name: print stdout
      debug:
        msg: ""</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">运行</div>
<div class="content">
<pre class="highlightjs highlight"><code data-lang="bash" class="language-bash hljs">[root@localhost ~]# ansible-playbook /etc/ansible/hellow.yml

PLAY [say 'hello world'] ****************************

TASK [Gathering Facts] ******************************
ok: [10.23.101.x]

TASK [echo 'hello world'] ***************************
changed: [10.23.101.x]

TASK [print stdout] *********************************
ok: [10.23.101.x] =&gt; {
    "msg": ""
}

PLAY RECAP ****************************************************
10.23.101.x               : ok=3    changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0</code></pre>
</div>
</div>
<div style="page-break-after: always;"></div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2020-10-22 16:06:42 +0800
</div>
</div>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.15.6/highlight.min.js"></script>
<script>hljs.initHighlighting()</script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  messageStyle: "none",
  tex2jax: {
    inlineMath: [["\\(", "\\)"]],
    displayMath: [["\\[", "\\]"]],
    ignoreClass: "nostem|nolatexmath"
  },
  asciimath2jax: {
    delimiters: [["\\$", "\\$"]],
    ignoreClass: "nostem|noasciimath"
  },
  TeX: { equationNumbers: { autoNumber: "none" } }
})
MathJax.Hub.Register.StartupHook("AsciiMath Jax Ready", function () {
  MathJax.InputJax.AsciiMath.postfilterHooks.Add(function (data, node) {
    if ((node = data.script.parentNode) && (node = node.parentNode) && node.classList.contains('stemblock')) {
      data.math.root.display = "block"
    }
    return data
  })
})
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_HTMLorMML"></script>
</body>
</html>